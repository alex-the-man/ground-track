import * as React from "react";
import * as ReactDOM from "react-dom";

import { radToDeg, degToRad, normalizeDegree } from "../astronomy/MathUtils";
import { j2000, j2000jd, unixTimestampToJulianDate } from "../astronomy/JulianUtils";
import CelestialObject from "../astronomy/CelestialObject";
import Sun from "../astronomy/Sun";
import Moon from "../astronomy/Moon";
import MapCircle from "./MapCircle";
import MapPolyline from "./MapPolyline";
import MapMarker from "./MapMarker";
import Map from "./Map";

import EquatorialCoordinate from "../astronomy/EquatorialCoordinate";

import LatLngLiteral = google.maps.LatLngLiteral

import math = require("mathjs")
var projector = require('ecef-projector');
class GroundTrack {
  pastLine: Array<LatLngLiteral> = [];
  futureLine: Array<LatLngLiteral> = [];
  position: LatLngLiteral;
}

function calculateGroundTrack(object: CelestialObject, midpointJd: number, periodInJulianDay: number, numSamples: number): GroundTrack {
  const midpoint = Math.floor(numSamples / 2);
  const track: GroundTrack = new GroundTrack();

  for (var i = 0; i <= numSamples; i++) {
    const jd = (i - midpoint) / numSamples * periodInJulianDay + midpointJd;
    const gecPos = object.pos(jd);
    const eciPos = gecPos.toECI();
    const ecefPos = eciPos.eciToECEF(jd);
    const latLng = ecefPos.ecefToWGS84();

    if (i == midpoint) {
      track.pastLine.push(latLng);
      track.futureLine.push(latLng);
      track.position = latLng;
    } else if (i > midpoint) {
      track.futureLine.push(latLng);
    } else {
      track.pastLine.push(latLng);
    }
  }

  return track;
}

interface AppState {
  now: number
}

class MapGroundTrackProps {
  groundTrack: GroundTrack;
  iconSize?: number;
  iconUrl?: string;
}

class MapGroundTrack extends React.Component<MapGroundTrackProps, undefined> {
  render(): any {
    const track = this.props.groundTrack;
    const iconUrl = this.props.iconUrl;
    const iconSize = this.props.iconSize;

    return (
      <div>
        <MapPolyline latLngs={track.pastLine} color="#AAA" opacity={0.9}/>
        <MapMarker pos={track.position} iconUrl={iconUrl} iconSize={iconSize} />
        <MapPolyline latLngs={track.futureLine} opacity={0.9}/>
      </div>
    );
  }
}

// const sunPosList = [[-129156156.7511105, 72348893.74804649, 31364175.28834028], [-129156172.09953341, 72348870.68238564, 31364165.29066943], [-129156187.44794242, 72348847.61673555, 31364155.293003228], [-129156202.79635224, 72348824.55107413, 31364145.29533219], [-129156218.14477172, 72348801.48538816, 31364135.297650468], [-129156233.49316268, 72348778.41973488, 31364125.299982894], [-129156248.84156345, 72348755.35405685, 31364115.302304637], [-129156264.18994795, 72348732.2883931, 31364105.304632496], [-129156279.53833666, 72348709.22271293, 31364095.30695332], [-129156294.88672154, 72348686.15702851, 31364085.30927222], [-129156310.23509373, 72348663.09135294, 31364075.311595056], [-129156325.58346875, 72348640.02566315, 31364065.31391159], [-129156340.93183565, 72348616.95997542, 31364055.31622912], [-129156356.28019196, 72348593.89429344, 31364045.318549134], [-129156371.62855355, 72348570.82859354, 31364035.32086136], [-129156386.97689672, 72348547.76291122, 31364025.323181175], [-129156402.32524624, 72348524.69720916, 31364015.32549249], [-129156417.67359424, 72348501.63149938, 31364005.327800438], [-129156433.02192497, 72348478.5658054, 31363995.330115203], [-129156433.14938153, 72348446.97394921, 31363981.636229098], [-129156448.49771301, 72348423.90823399, 31363971.638534658], [-129156463.8460284, 72348400.84253281, 31363961.640846316], [-129156479.19434565, 72348377.77681872, 31363951.643152412], [-129156494.54265127, 72348354.71111205, 31363941.645461697], [-129156509.89096098, 72348331.64538915, 31363931.64776396], [-129156525.23926349, 72348308.57966697, 31363921.650066495], [-129156540.58755444, 72348285.513952, 31363911.652372226], [-129156555.93585162, 72348262.44821763, 31363901.654669452], [-129156571.28414407, 72348239.38248023, 31363891.656965487], [-129156586.63241802, 72348216.31676064, 31363881.65926911], [-129156601.98069721, 72348193.25102298, 31363871.66156497], [-129156617.32896703, 72348170.18528932, 31363861.66386257], [-129156632.6772387, 72348147.11954282, 31363851.66615459], [-129156648.02550547, 72348124.0537936, 31363841.668445423], [-129156663.37375835, 72348100.9880551, 31363831.670740906], [-129156678.7220164, 72348077.9222988, 31363821.673028637], [-129156694.07027747, 72348054.85652782, 31363811.675310068], [-129156709.41851795, 72348031.79077773, 31363801.67760053], [-129156724.7667614, 72348008.72501308, 31363791.679884687], [-129156740.11498763, 72347985.65926418, 31363781.68217569], [-129156755.4632201, 72347962.5934958, 31363771.684458204], [-129156770.81144993, 72347939.52772133, 31363761.686738074], [-129156786.15966032, 72347916.46196598, 31363751.689026244], [-129156801.50787818, 72347893.39618924, 31363741.691305194], [-129156816.85608888, 72347870.33041325, 31363731.693584412], [-129156832.20429023, 72347847.26464121, 31363721.695865367], [-129156847.55249675, 72347824.19885127, 31363711.698138557], [-129156862.90069719, 72347801.13306041, 31363701.7004113], [-129156878.24888046, 72347778.06728518, 31363691.702690866], [-129156893.59707126, 72347755.00148861, 31363681.704961237], [-129156908.94524357, 72347731.93570977, 31363671.707239155], [-129156924.29342452, 72347708.86990778, 31363661.709507145], [-129156939.64160052, 72347685.80410314, 31363651.711773936], [-129156954.98976499, 72347662.73830576, 31363641.714043926], [-129156970.33792675, 72347639.67250232, 31363631.716311257], [-129156985.68609145, 72347616.60668437, 31363621.718572292], [-129157001.03423998, 72347593.54088067, 31363611.720839437], [-129157016.38238826, 72347570.47506721, 31363601.72310248], [-129157031.73052484, 72347547.40926129, 31363591.72536872], [-129157047.07866551, 72347524.3434391, 31363581.72762792], [-129157062.42680351, 72347501.27761082, 31363571.72988447], [-129157077.77493548, 72347478.21178144, 31363561.732140582], [-129157093.12305366, 72347455.14596285, 31363551.734401323], [-129157108.47117805, 72347432.0801247, 31363541.73665359], [-129157123.81929423, 72347409.01428886, 31363531.738906845], [-129157139.1673978, 72347385.94846188, 31363521.741164025], [-129157154.51550531, 72347362.88261883, 31363511.74341417], [-129157169.86360233, 72347339.81678146, 31363501.7456668], [-129157185.21170339, 72347316.75092797, 31363491.747912392], [-129157185.33883317, 72347285.15905821, 31363478.054020364], [-129157200.68690924, 72347262.09322202, 31363468.05627352], [-129157216.03498939, 72347239.02736965, 31363458.05851964], [-129157231.38306566, 72347215.96151307, 31363448.060763836], [-129157246.73113614, 72347192.89565499, 31363438.06300758], [-129157262.07920153, 72347169.82979451, 31363428.065250132], [-129157277.42725097, 72347146.76394789, 31363418.06749881], [-129157292.77530876, 72347123.69807869, 31363408.06973753], [-129157308.12336184, 72347100.63220641, 31363398.07197506], [-129157323.47140093, 72347077.56634511, 31363388.07421724], [-129157338.81944199, 72347054.50047076, 31363378.076453857], [-129157354.16748258, 72347031.43458694, 31363368.078686357], [-129157369.51550364, 72347008.36872241, 31363358.080927156], [-129157384.86353439, 72346985.30283324, 31363348.083157282], [-129157400.21154918, 72346962.23695794, 31363338.085393526], [-129157415.559568, 72346939.17106652, 31363328.08762274], [-129157430.90758394, 72346916.10516936, 31363318.089849297], [-129157446.25558291, 72346893.03928754, 31363308.092082705], [-129157461.60358705, 72346869.97338788, 31363298.094308354], [-129157476.95158401, 72346846.90748888, 31363288.09653426], [-129157492.29957037, 72346823.84159584, 31363278.098762657], [-129157507.64756201, 72346800.77568461, 31363268.100983273], [-129157522.99553312, 72346777.70979425, 31363258.10321293], [-129157538.34351613, 72346754.6438759, 31363248.105430428], [-129157553.69148743, 72346731.57796502, 31363238.10765113], [-129157569.0394506, 72346708.51205628, 31363228.10987284], [-129157584.38741885, 72346685.44612978, 31363218.112086795], [-129157599.73537895, 72346662.38020547, 31363208.11430175], [-129157615.08332734, 72346639.31428866, 31363198.116519883], [-129157630.43127757, 72346616.24835902, 31363188.11873247], [-129157645.77922526, 72346593.18242306, 31363178.12094239], [-129157661.12716681, 72346570.11648622, 31363168.12315185], [-129157676.47510464, 72346547.05054489, 31363158.1253594], [-129157691.82302748, 72346523.98461603, 31363148.12757233], [-129157707.1709521, 72346500.91867438, 31363138.129779685], [-129157722.51887532, 72346477.8527247, 31363128.131983668], [-129157737.86678676, 72346454.78678267, 31363118.134190843], [-129157753.21469793, 72346431.7208309, 31363108.136393912], [-129157768.56260636, 72346408.65487324, 31363098.138594333], [-129157783.91049871, 72346385.58892955, 31363088.140800864], [-129157799.2583974, 72346362.52296628, 31363078.142998897], [-129157814.6062811, 72346339.45701548, 31363068.14520232], [-129157829.95416878, 72346316.3910486, 31363058.14739871], [-129157845.3020551, 72346293.32507364, 31363048.14959172], [-129157860.6499218, 72346270.25911807, 31363038.151793044], [-129157875.99779832, 72346247.19313769, 31363028.153983686], [-129157891.34566773, 72346224.12715785, 31363018.15617459], [-129157906.69352199, 72346201.0611907, 31363008.15837087], [-129157922.04138146, 72346177.99520567, 31362998.160559405], [-129157937.389226, 72346154.92923291, 31362988.162753325], [-129157937.51602116, 72346123.33736128, 31362974.468860526], [-129157952.86385302, 72346100.27138741, 31362964.471053954], [-129157968.21169342, 72346077.20539059, 31362954.473237455], [-129157983.5595233, 72346054.13939957, 31362944.475423418], [-129157998.90735282, 72346031.07339892, 31362934.47760526], [-129158014.25517397, 72346008.00740075, 31362924.47978813], [-129158029.60298367, 72345984.9414097, 31362914.48197417], [-129158044.95080288, 72345961.87539431, 31362904.484149527], [-129158060.2985971, 72345938.80940636, 31362894.486336842], [-129158075.64639993, 72345915.74339534, 31362884.488514215], [-129158090.9942023, 72345892.67737503, 31362874.490687456], [-129158106.34199305, 72345869.61136194, 31362864.492863923], [-129158121.68978672, 72345846.5453344, 31362854.495034076], [-129158137.03757325, 72345823.47930762, 31362844.4972045], [-129158152.38534378, 72345800.4132947, 31362834.499381036], [-129158167.73312159, 72345777.3472607, 31362824.501548354], [-129158183.08088228, 72345754.28124236, 31362814.503722508], [-129158198.42865272, 72345731.2151993, 31362804.505885996], [-129158213.77641474, 72345708.1491588, 31362794.508050464], [-129158229.12416299, 72345685.08312888, 31362784.510219608], [-129158244.47191414, 72345662.01708452, 31362774.512382448], [-129158259.81966048, 72345638.95103727, 31362764.514544085], [-129158275.16739517, 72345615.88499747, 31362754.51670892], [-129158290.51512937, 72345592.8189483, 31362744.518869646], [-129158305.86285539, 72345569.75290133, 31362734.521031387], [-129158321.2105844, 72345546.68683974, 31362724.52318682], [-129158336.55830623, 72345523.62077889, 31362714.52534253], [-129158351.90601756, 72345500.55472375, 31362704.527500704], [-129158367.25372963, 72345477.48865734, 31362694.52965402], [-129158382.60143791, 72345454.42258655, 31362684.531805426], [-129158397.94913231, 72345431.35652652, 31362674.53396149], [-129158413.29682963, 72345408.29045208, 31362664.536111254], [-129158428.6445132, 72345385.2243881, 31362654.538265653], [-129158443.99220075, 72345362.15830809, 31362644.540413048], [-129158459.33988565, 72345339.09222195, 31362634.54255779], [-129158474.68755792, 72345316.02614468, 31362624.544706456], [-129158490.03523077, 72345292.96005653, 31362614.546850264], [-129158505.38290095, 72345269.8939622, 31362604.54899145], [-129158520.73055741, 72345246.82787849, 31362594.551137265], [-129158536.07821898, 72345223.76177692, 31362584.553275324], [-129158551.4258656, 72345200.69568779, 31362574.55541878], [-129158566.77351625, 72345177.62958242, 31362564.557555206], [-129158582.12117435, 72345154.56345585, 31362554.559682406], [-129158597.4688052, 72345131.49736013, 31362544.561823007], [-129158612.81644227, 72345108.43124491, 31362534.56395512], [-129158628.16407225, 72345085.3651303, 31362524.56608752], [-129158643.51168732, 72345062.29902798, 31362514.568225306], [-129158658.85930975, 72345039.23290455, 31362504.570353862], [-129158674.20692834, 72345016.16677672, 31362494.5724805], [-129158689.55453096, 72344993.10066284, 31362484.574613247], [-129158689.68098913, 72344961.50879295, 31362470.880721107], [-129158705.02858347, 72344938.44267137, 31362460.882850472], [-129158720.37618072, 72344915.37653522, 31362450.884973533], [-129158735.72376758, 72344892.31040463, 31362440.887099057], [-129158751.07134497, 72344869.24427824, 31362430.889226325], [-129158766.41892636, 72344846.1781357, 31362420.891346544], [-129158781.76650526, 72344823.11198677, 31362410.893464126], [-129158797.11406463, 72344800.04585713, 31362400.89559], [-129158812.4616325, 72344776.97970459, 31362390.897705946], [-129158827.80918883, 72344753.9135593, 31362380.899825066], [-129158843.15674137, 72344730.8474097, 31362370.90194226], [-129158858.5042946, 72344707.78124887, 31362360.90405465], [-129158873.8518418, 72344684.71508703, 31362350.906166553], [-129158889.19937298, 72344661.64893922, 31362340.90828457], [-129158904.54691379, 72344638.58276677, 31362330.91039192], [-129158919.89444745, 72344615.51659507, 31362320.91249954], [-129158935.24196722, 72344592.45043403, 31362310.914611798], [-129158950.58949114, 72344569.3842567, 31362300.916717038], [-129158965.93699786, 72344546.31809515, 31362290.918829113], [-129158981.28450967, 72344523.25191586, 31362280.92093344], [-129158996.63202116, 72344500.18572696, 31362270.923033647], [-129159011.9795164, 72344477.11955242, 31362260.925139956], [-129159027.32701814, 72344454.05335791, 31362250.92723781], [-129159042.67451039, 72344430.98716766, 31362240.92933737], [-129159058.02200228, 72344407.92096779, 31362230.93143283], [-129159073.36948587, 72344384.85477035, 31362220.933529302], [-129159088.71695448, 72344361.78858532, 31362210.93563114], [-129159104.0644317, 72344338.72237721, 31362200.937723037], [-129159119.41190286, 72344315.65616815, 31362190.939814467], [-129159134.7593624, 72344292.5899665, 31362180.941909097], [-129159150.10682501, 72344269.52375005, 31362170.943997413], [-129159165.45428032, 72344246.45753458, 31362160.94608602], [-129159180.80171968, 72344223.39133292, 31362150.94818074], [-129159196.14916295, 72344200.32511531, 31362140.95026842], [-129159211.49659468, 72344177.25890492, 31362130.95235929], [-129159226.8440305, 72344154.19267829, 31362120.954443134], [-129159242.1914614, 72344131.12644899, 31362110.95652579], [-129159257.53887838, 72344108.06023051, 31362100.958613113], [-129159272.886303, 72344084.99399044, 31362090.960691202], [-129159288.23371913, 72344061.92775306, 31362080.962770294], [-129159303.58112386, 72344038.86152266, 31362070.96485257], [-129159318.92853472, 72344015.795273, 31362060.96692636], [-129159334.27592954, 72343992.72903733, 31362050.969006278], [-129159349.6233273, 72343969.6627872, 31362040.97107987], [-129159364.9707202, 72343946.59653418, 31362030.973152306], [-129159380.31810252, 72343923.53028706, 31362020.975227192], [-129159395.66548343, 72343900.46403192, 31362010.97729869], [-129159411.01286279, 72343877.39776905, 31362000.979366817], [-129159426.36023046, 72343854.33151364, 31361990.981438134], [-129159441.70759663, 72343831.26525033, 31361980.98350608], [-129159457.05495118, 72343808.19899443, 31361970.98557721], [-129159457.18107481, 72343776.60711256, 31361957.291679893], [-129159472.52842335, 72343753.5408455, 31361947.293746166], [-129159487.87576371, 72343730.47458063, 31361937.295813452], [-129159503.22310588, 72343707.40830298, 31361927.297875173], [-129159518.57045764, 72343684.34200087, 31361917.29992621], [-129159533.91778104, 72343661.27573118, 31361907.30199139], [-129159549.26510967, 72343638.20944354, 31361897.3040488], [-129159564.61243443, 72343615.14315169, 31361887.306104314], [-129159579.95974322, 72343592.0768737, 31361877.308165923], [-129159595.30705932, 72343569.01057468, 31361867.31021832], [-129159610.65436158, 72343545.94428627, 31361857.31227536], [-129159626.00166567, 72343522.8779851, 31361847.31432684], [-129159641.34896722, 72343499.81167768, 31361837.31637567], [-129159656.6962514, 72343476.74538615, 31361827.318431336], [-129159672.04353975, 72343453.67907834, 31361817.320479985], [-129159687.39082876, 72343430.61275946, 31361807.322523784], [-129159702.73809832, 72343407.54645966, 31361797.324575897], [-129159718.08537188, 72343384.48014379, 31361787.32662097], [-129159733.43263511, 72343361.41383336, 31361777.328668505], [-129159748.77990119, 72343338.34750853, 31361767.330709748], [-129159764.12716578, 72343315.28117588, 31361757.33274761], [-129159779.4744209, 72343292.21484728, 31361747.33478721], [-129159794.82166234, 72343269.14852922, 31361737.336831458], [-129159810.16890877, 72343246.08219354, 31361727.338867947], [-129159825.51615043, 72343223.01585491, 31361717.340903237], [-129159840.86338378, 72343199.94951868, 31361707.342939537], [-129159856.21061678, 72343176.88317291, 31361697.344971728], [-129159871.55783142, 72343153.81684467, 31361687.34701149], [-129159886.90505564, 72343130.75049195, 31361677.34904058], [-129159902.25227061, 72343107.68414293, 31361667.3510714], [-129159917.59947278, 72343084.61780311, 31361657.353106134], [-129159932.94668572, 72343061.55143698, 31361647.35512947], [-129159948.29389054, 72343038.485073, 31361637.357153803], [-129159963.64107682, 72343015.41872685, 31361627.35918571], [-129159978.98826957, 72342992.35236079, 31361617.361209128], [-129159994.3354472, 72342969.28600734, 31361607.363237917], [-129160009.68264583, 72342946.21961232, 31361597.365248736], [-129160025.02982609, 72342923.15323474, 31361587.36726712], [-129160040.3769914, 72342900.08686957, 31361577.369290885], [-129160055.7241618, 72342877.02048662, 31361567.37130691], [-129160071.07132629, 72342853.95410246, 31361557.37332246], [-129160086.41848025, 72342830.88772409, 31361547.37534048], [-129160101.76563495, 72342807.82133444, 31361537.377353653], [-129160117.1127735, 72342784.75495902, 31361527.379372954], [-129160132.45992061, 72342761.68856066, 31361517.381382283], [-129160147.80705833, 72342738.62216619, 31361507.38339337], [-129160163.15418789, 72342715.55577403, 31361497.38540543], [-129160178.50131921, 72342692.48936911, 31361487.38741194], [-129160193.84844452, 72342669.42296305, 31361477.389417995], [-129160209.19555815, 72342646.35656457, 31361467.39142722], [-129160209.3213426, 72342614.76468761, 31361453.69753202], [-129160224.66844243, 72342591.69828962, 31361443.699541543], [-129160240.01554863, 72342568.63187192, 31361433.70154255], [-129160255.36264992, 72342545.56545156, 31361423.703542367], [-129160270.70973615, 72342522.4990437, 31361413.705547582], [-129160286.05682656, 72342499.43261948, 31361403.707545754], [-129160301.40391088, 72342476.36619428, 31361393.709543474], [-129160316.75098367, 72342453.29977639, 31361383.711544383], [-129160332.09805928, 72342430.23334411, 31361373.713538993], [-129160347.44512334, 72342407.16691908, 31361363.71553679], [-129160362.79218929, 72342384.10048115, 31361353.71752903], [-129160378.13925256, 72342361.03403716, 31361343.719518613], [-129160393.48629965, 72342337.96760735, 31361333.72151432], [-129160408.8333498, 72342314.90116292, 31361323.723503716], [-129160424.18040054, 72342291.83470742, 31361313.725488283], [-129160439.52743417, 72342268.7682676, 31361303.72747968], [-129160454.87446736, 72342245.70181833, 31361293.72946698], [-129160470.22151467, 72342222.63533773, 31361283.73144067], [-129160485.56853473, 72342199.56888801, 31361273.733427778], [-129160500.91555543, 72342176.50242724, 31361263.735410053], [-129160516.2625623, 72342153.43597715, 31361253.737396974], [-129160531.60957778, 72342130.36950402, 31361243.739373952], [-129160546.95658831, 72342107.30302824, 31361233.741349727], [-129160562.30358498, 72342084.23656319, 31361223.743330173], [-129160577.6505835, 72342061.17008522, 31361213.74530503], [-129160592.99757826, 72342038.10360289, 31361203.747277975], [-129160608.34456027, 72342015.0371296, 31361193.749254856], [-129160623.69154523, 72341991.97064176, 31361183.75122543], [-129160639.0385141, 72341968.90416798, 31361173.75320212], [-129160654.38548924, 72341945.8376748, 31361163.75517031], [-129160669.73244832, 72341922.77119552, 31361153.75714463], [-129160685.07941596, 72341899.70469332, 31361143.759108987], [-129160700.42636636, 72341876.63820699, 31361133.76108018], [-129160715.77332307, 72341853.57170108, 31361123.763042893], [-129160731.12027483, 72341830.50519244, 31361113.765004423], [-129160746.46721283, 72341807.43869448, 31361103.76697058], [-129160761.81415266, 72341784.37218356, 31361093.76893119], [-129160777.16107632, 72341761.30568692, 31361083.770897914], [-129160792.50801305, 72341738.2391606, 31361073.772851776], [-129160807.85493928, 72341715.17263986, 31361063.77480809], [-129160823.20184943, 72341692.10613324, 31361053.776770514], [-129160838.54876916, 72341669.03960215, 31361043.778722256], [-129160853.89568308, 72341645.9730696, 31361033.780673545], [-129160869.24258299, 72341622.90654811, 31361023.782629482], [-129160884.58948588, 72341599.84001201, 31361013.784579124], [-129160899.9363771, 72341576.77348334, 31361003.786531955], [-129160915.28326349, 72341553.70695187, 31360993.788483605], [-129160930.63015395, 72341530.64040415, 31360983.7904282], [-129160945.97702943, 72341507.5738689, 31360973.792378202], [-129160961.32391682, 72341484.50730559, 31360963.79431606], [-129160961.44937111, 72341452.91542013, 31360950.100417174], [-129160976.79622777, 72341429.84888288, 31360940.10236624], [-129160992.14308865, 72341406.7823291, 31360930.104308277], [-129161007.48993331, 72341383.71578974, 31360920.106256433], [-129161022.8367888, 72341360.64922388, 31360910.108193178], [-129161038.18363383, 72341337.5826637, 31360900.110132392], [-129161053.53047171, 72341314.51610418, 31360890.11207187], [-129161068.87731029, 72341291.4495335, 31360880.114006512], [-129161084.22414288, 72341268.38296175, 31360870.115940697], [-129161099.57096496, 72341245.31639564, 31360860.117877334], [-129161114.91779006, 72341222.249815, 31360850.119807675], [-129161130.26459444, 72341199.18325533, 31360840.12174705], [-129161145.6114097, 72341176.11666927, 31360830.123675015], [-129161160.95822002, 72341153.05008043, 31360820.1256018], [-129161176.30501653, 72341129.98350233, 31360810.127533235], [-129161191.65181477, 72341106.91691154, 31360800.129459094], [-129161206.99860938, 72341083.85031609, 31360790.13138304], [-129161222.3453923, 72341060.78372811, 31360780.133310184], [-129161237.69217709, 72341037.71712722, 31360770.135231752], [-129161253.03894573, 72341014.65054052, 31360760.137159437], [-129161268.38572404, 72340991.58392914, 31360750.139076423], [-129161283.73249304, 72340968.51732175, 31360740.140995163], [-129161299.07925034, 72340945.45072182, 31360730.14291709], [-129161314.42601521, 72340922.3841004, 31360720.144829795], [-129161329.77277054, 72340899.31748325, 31360710.14674423], [-129161345.11951207, 72340876.25087674, 31360700.148663323], [-129161360.4662555, 72340853.18425721, 31360690.15057684], [-129161375.81299956, 72340830.11762671, 31360680.15248553], [-129161391.15972862, 72340807.05100863, 31360670.15439959], [-129161406.50645846, 72340783.98437929, 31360660.156308826], [-129161421.85319008, 72340760.91773716, 31360650.15821248], [-129161437.19991352, 72340737.85109729, 31360640.160117146], [-129161452.5466297, 72340714.78445818, 31360630.16202206], [-129161467.89333442, 72340691.71782622, 31360620.16393019], [-129161483.2400397, 72340668.65118328, 31360610.165833477], [-129161498.5867469, 72340645.58452743, 31360600.167731196], [-129161513.93343347, 72340622.51789248, 31360590.16963794], [-129161529.28012864, 72340599.4512345, 31360580.17153474], [-129161544.62680656, 72340576.38459234, 31360570.173438385], [-129161559.97348855, 72340553.31793393, 31360560.175335], [-129161575.32016903, 72340530.25126773, 31360550.17722823]];
// const moonPosList = [[-315111.8081480276, 180318.25809764143, 80739.97703458973], [-315112.4274316502, 180317.43214246116, 80739.72560712301], [-315113.01720246236, 180316.58929890645, 80739.46661766298], [-315113.60697069037, 180315.7464539225, 80739.20762755771], [-315114.19673634064, 180314.90360749947, 80738.94863680485], [-315114.7864994074, 180314.0607596468, 80738.68964540593], [-315115.4057704388, 180313.23479681154, 80738.43821456545], [-315115.99552839383, 180312.39194601378, 80738.17922184909], [-315116.5853062709, 180311.54905924722, 80737.9202177844], [-315117.1750590618, 180310.70620558495, 80737.6612237755], [-315117.7648092709, 180309.8633504898, 80737.4022291206], [-315118.38406776416, 180309.03737992595, 80737.15079486281], [-315118.97381286195, 180308.1945218853, 80736.89179889037], [-315119.5635553747, 180307.35166241697, 80736.63280227294], [-315120.15329531033, 180306.50880150864, 80736.37380500765], [-315120.77256624395, 180305.68279027197, 80736.12235733595], [-315121.3623010635, 180304.83992642534, 80735.86335875472], [-315121.95203324815, 180303.99706122337, 80735.60435956207], [-315122.54176290374, 180303.15419451197, 80735.34535968848], [-315123.13148997945, 180302.31132636513, 80735.0863591675], [-315123.7507257533, 180301.48534211403, 80734.83491884713], [-315124.34044771525, 180300.6424710255, 80734.5759170099], [-315124.9301896636, 180299.79956387018, 80734.31690378395], [-315125.5199064613, 180298.95668991702, 80734.05790065438], [-315126.109620618, 180298.11381461815, 80733.79889691522], [-315126.7288438592, 180297.28782262583, 80733.54745318458], [-315127.3185529636, 180296.44494429496, 80733.28844809144], [-315127.9082594307, 180295.6020646124, 80733.02944238721], [-315128.49796337064, 180294.75918341748, 80732.7704360017], [-315129.08766473096, 180293.91630078648, 80732.51142896888], [-315129.70689787884, 180293.09026661213, 80732.25997115398], [-315130.29659412487, 180292.24738104007, 80732.00096280497], [-315130.88628779154, 180291.40449403165, 80731.74195380855], [-315131.47597887367, 180290.56160559482, 80731.48294416723], [-315132.065667376, 180289.71871572238, 80731.22393387854], [-315132.68486536655, 180288.89270852908, 80730.97248342386], [-315133.2745487571, 180288.0498157116, 80730.71347181789], [-315133.8642521245, 180287.20688684355, 80730.454448817], [-315134.4539302932, 180286.36399124598, 80730.19543595568], [-315135.04360593756, 180285.52109413198, 80729.93642241125], [-315135.6627913875, 180284.69507921414, 80729.68496854011], [-315136.2524619197, 180283.85217915222, 80729.4259536871], [-315136.84212987026, 180283.00927766116, 80729.16693817922], [-315137.4317951771, 180282.16637483233, 80728.9079220549], [-315138.0214805252, 180281.3234358484, 80728.6488945131], [-315138.6406533794, 180280.49741328665, 80728.39743726148], [-315139.2302884349, 180279.65454069956, 80728.1384299219], [-315139.8199435272, 180278.81163196766, 80727.87941115836], [-315140.40959603485, 180277.9687218077, 80727.62039174982], [-315141.02875882515, 180277.1426931117, 80727.36893178771], [-315141.6184062231, 180276.29978000355, 80727.10991106153], [-315142.20805103914, 180275.45686546323, 80726.8508896885], [-315142.7977157731, 180274.6139149511, 80726.59185696526], [-315143.38735542435, 180273.770997547, 80726.33283430063], [-315144.00650556147, 180272.9449612912, 80726.08137099436], [-315144.59614009917, 180272.10204094538, 80725.82234701296], [-315145.18577205687, 180271.25911916426, 80725.56332238435], [-315145.7754014302, 180270.4161959544, 80725.30429711072], [-315146.3650281629, 180269.57327140236, 80725.0452712189], [-315146.9841883226, 180268.7471927841, 80724.79379376238], [-315147.57381000184, 180267.9042651977, 80724.53476652551], [-315148.16342910094, 180267.061336176, 80724.27573864139], [-315148.75304555893, 180266.2184058127, 80724.01671013981], [-315149.3426594915, 180265.37547393056, 80723.7576809646], [-315149.9617844362, 180264.54942238872, 80723.50621089769], [-315150.5513932568, 180263.70648756204, 80723.24718040535], [-315151.14099949744, 180262.86355130034, 80722.98814926576], [-315151.730625656, 180262.02057906333, 80722.7291067753], [-315152.3202267301, 180261.17763994072, 80722.4700743447], [-315152.93933913537, 180260.35158067246, 80722.21860086128], [-315153.5289350973, 180259.50863860582, 80721.95956711359], [-315154.1185284791, 180258.66569510387, 80721.70053271875], [-315154.7081192785, 180257.82275017037, 80721.4414976784], [-315155.297707439, 180256.97980388804, 80721.18246202763], [-315155.91682980425, 180256.15370235025, 80720.93097442278], [-315156.50641285034, 180255.3107531272, 80720.67193745599], [-315157.09599337354, 180254.46780238525, 80720.41289980564], [-315157.68557131203, 180253.62485021522, 80720.15386151054], [-315158.27514667076, 180252.7818966093, 80719.89482256821], [-315158.89423388295, 180251.95582205633, 80719.64334232458], [-315159.4838041274, 180251.11286550987, 80719.38430206625], [-315160.0733942905, 180250.26987298802, 80719.12525044694], [-315160.6629593701, 180249.42691357815, 80718.86620889654], [-315161.2820364585, 180248.60083297858, 80718.61472597999], [-315161.8715964302, 180247.75787061802, 80718.35568311106], [-315162.461153754, 180246.9149069229, 80718.09663963538], [-315163.05070855946, 180246.0719417014, 80717.83759547469], [-315163.64026077994, 180245.2289750525, 80717.57855066923], [-315164.25932532887, 180244.40288672713, 80717.32706433655], [-315164.84889493725, 180243.55988258636, 80717.06800750745], [-315165.4384394634, 180242.7169115613, 80716.80896073882], [-315166.0279814095, 180241.873939101, 80716.54991332314], [-315166.6175207711, 180241.03096521247, 80716.29086526248], [-315167.23657266743, 180240.20486932638, 80716.03937558572], [-315167.82610691927, 180239.36189249012, 80715.780326207], [-315168.4156385862, 180238.51891422627, 80715.52127618332], [-315169.0051901708, 180237.67589998525, 80715.26221479815], [-315169.59471667284, 180236.8329188581, 80715.00316348257], [-315170.2137560275, 180236.00681524954, 80714.75167039008], [-315170.8032774198, 180235.1638311748, 80714.49261775633], [-315171.3927962275, 180234.32084567187, 80714.2335644777], [-315171.98231245525, 180233.47785873356, 80713.97451055194], [-315172.5718260408, 180232.63487044768, 80713.71545602633], [-315173.1908528001, 180231.80875919503, 80713.46395955364], [-315173.780383828, 180230.9657333425, 80713.20489295085], [-315174.3698897762, 180230.12274060084, 80712.94583641723], [-315174.95939314616, 180229.27974642135, 80712.68677923622], [-315175.54889392975, 180228.43675081624, 80712.42772141063], [-315176.1679080289, 180227.61063201548, 80712.17622159651], [-315176.75740370236, 180226.76763346355, 80711.91716245297], [-315177.34689679125, 180225.9246334834, 80711.65810266446], [-315177.9364098567, 180225.0815974324, 80711.39903148523], [-315178.52589771955, 180224.238594683, 80711.13997043397], [-315179.1448992826, 180223.41246815096, 80710.8884672023], [-315179.7343820412, 180222.5694624413, 80710.62940483977], [-315180.32386227057, 180221.72645522267, 80710.37034179653], [-315180.9133399195, 180220.88344656953, 80710.1112781063], [-315181.5323314125, 180220.05731390897, 80709.85977217581], [-315182.1218264444, 180219.21426776913, 80709.6006964538], [-315182.7112963983, 180218.37125474113, 80709.3416308007], [-315183.30076376785, 180217.5282402846, 80709.08256450272], [-315183.8902285574, 180216.68522439303, 80708.82349755769], [-315184.5092074527, 180215.85908409572, 80708.57198823908], [-315185.0986670728, 180215.01606534407, 80708.31292001337], [-315185.6881241669, 180214.17304507803, 80708.05385110628], [-315186.27757867886, 180213.33002338043, 80707.79478155266], [-315186.86705310066, 180212.48696570785, 80707.53570064693], [-315187.48601940024, 180211.66081776674, 80707.28418794839], [-315188.0754662172, 180210.81779169428, 80707.02511643192], [-315188.66491044953, 180209.97476419373, 80706.7660442707], [-315189.2543521017, 180209.13173525836, 80706.50697146232], [-315189.8437911106, 180208.28870498476, 80706.24789803702], [-315190.46274475503, 180207.46254948393, 80705.99638200412], [-315191.05220126477, 180206.6194815399, 80705.73729648914], [-315191.64163263695, 180205.7764468021, 80705.47822107338], [-315192.23106136994, 180204.93341071974, 80705.21914503911], [-315192.8204875794, 180204.09037311573, 80704.96006833034], [-315193.4394286818, 180203.2642098973, 80704.70854887337], [-315194.0288497791, 180202.42116934943, 80704.44947084782], [-315194.61826829106, 180201.57812737452, 80704.19039217757], [-315195.20768422313, 180200.73508396448, 80703.93131286027], [-315195.797120065, 180199.89200457578, 80703.67222219029], [-315196.41604856914, 180199.06583371802, 80703.42069935407], [-315197.005456749, 180198.2227860168, 80703.1616181103], [-315197.59486240096, 180197.37973680467, 80702.90253618565], [-315198.1842654748, 180196.5366861541, 80702.64345361343], [-315198.77366596414, 180195.6936340757, 80702.38437039594], [-315199.3925818703, 180194.86745557812, 80702.13284418042], [-315199.9819997384, 180194.02436600925, 80701.8737489392], [-315200.5713925302, 180193.18130955985, 80701.61466376012], [-315201.1607827415, 180192.33825167615, 80701.35557793408], [-315201.7796885821, 180191.51206704718, 80701.10404900915], [-315202.36907362164, 180190.66900630714, 80700.8449619037], [-315202.95845613786, 180189.82594404896, 80700.5858741151], [-315203.54783601005, 180188.9828804538, 80700.32678571042], [-315204.137235911, 180188.13978069506, 80700.06768589439], [-315204.75612915325, 180187.31358842662, 80699.81615359036], [-315205.3455013892, 180186.4705203668, 80699.5570631945], [-315205.9348709858, 180185.62745096275, 80699.29797218033], [-315206.5242380566, 180184.78438004054, 80699.03888049269], [-315207.11360254727, 180183.94130768342, 80698.77978815818], [-315207.73248319095, 180183.11510777654, 80698.5282524751], [-315208.3218425094, 180182.2720325638, 80698.26915886128], [-315208.91122185165, 180181.42892120103, 80698.01005382076], [-315209.50057600474, 180180.58584312611, 80697.75095891529], [-315210.08992763475, 180179.74276353262, 80697.49186332665], [-315210.7087956819, 180178.9165559837, 80697.24032426414], [-315211.2981421966, 180178.07347345146, 80696.98122736], [-315211.88748613105, 180177.23038948455, 80696.72212980893], [-315212.4768274806, 180176.38730409002, 80696.46303161314], [-315213.0661887392, 180175.54418271198, 80696.2039220629], [-315213.6850441858, 180174.71796752745, 80695.95237962194], [-315214.2743777829, 180173.87487784246, 80695.69327949997], [-315214.8637088564, 180173.03178663977, 80695.43417869475], [-315215.4530373452, 180172.18869400938, 80695.17507724492], [-315216.0423632535, 180171.34559994453, 80694.91597514824], [-315216.6612061011, 180170.519377122, 80694.66442932915], [-315217.2505268355, 180169.67628020822, 80694.40532594491], [-315217.83986759593, 180168.83314712995, 80694.14621114945], [-315218.4291832256, 180167.99004726068, 80693.88710644531], [-315219.01849627326, 180167.1469459598, 80693.62800109459], [-315219.6373264612, 180166.32071559256, 80693.37645192495], [-315220.22663433646, 180165.4776114365, 80693.1173452951], [-315220.815939688, 180164.63450576298, 80692.85823798217], [-315221.40524245513, 180163.7913986611, 80692.59913002455], [-315222.0240851231, 180162.96512752413, 80692.34756741005], [-315222.6133827794, 180162.12201747645, 80692.0884581347], [-315223.20267785224, 180161.27890599883, 80691.82934821432], [-315223.791970343, 180160.43579308942, 80691.57023764758], [-315224.3812602487, 180159.59267875273, 80691.31112643612], [-315225.00006783014, 180158.76643452718, 80691.05957115075], [-315225.5893525658, 180157.9233173318, 80690.80045865901], [-315226.178657322, 180157.08016398485, 80690.54133473996], [-315226.76793689467, 180156.23704392373, 80690.28222095556], [-315227.357213939, 180155.39392235223, 80690.0231064903], [-315227.9760089214, 180154.5676704889, 80689.77154782637], [-315228.56528085266, 180153.72454597533, 80689.51243204475], [-315229.1545502056, 180152.88142002377, 80689.25331561569], [-315229.7438169714, 180152.0382926484, 80688.99419854252], [-315230.33308115706, 180151.19516383804, 80688.73508082249], [-315230.9518860263, 180150.368869787, 80688.48350807177], [-315231.5411450964, 180149.52573803827, 80688.22438903639], [-315232.1304015287, 180148.68260493918, 80687.96526939042], [-315232.71965543326, 180147.83947032885, 80687.70614906367], [-315233.3089066964, 180146.99633437782, 80687.4470281189], [-315233.92767648015, 180146.1700672399, 80687.19546269802], [-315234.5169226904, 180145.326928254, 80686.93634040872], [-315235.10618880234, 180144.4837532884, 80686.67720676483], [-315235.69542984955, 180143.6406114371, 80686.41808318287], [-315236.2846683096, 180142.79746816173, 80686.15895895679], [-315236.9034254938, 180141.97119338682, 80685.90739015737], [-315237.4926588409, 180141.12804716924, 80685.64826461488], [-315238.0818895505, 180140.284899601, 80685.38913846182], [-315238.6711177342, 180139.44175051863, 80685.13001162681], [-315239.28986484697, 180138.61546962173, 80684.87844012078], [-315239.87911040214, 180137.77228304584, 80684.61930126087], [-315240.4683308872, 180136.92912959468, 80684.36017246495], [-315241.05754879245, 180136.08597470832, 80684.10104302206], [-315241.64676411427, 180135.24281839214, 80683.84191293363], [-315242.2654986292, 180134.41652985546, 80683.59033804903], [-315242.8547087811, 180133.5733706804, 80683.33120668035], [-315243.44391640474, 180132.7302099949, 80683.07207463101], [-315244.03314393165, 180131.88701332372, 80682.81293122607], [-315244.6223463917, 180131.04384977336, 80682.5537978842], [-315245.2410683051, 180130.21755360323, 80682.30221962169], [-315245.83026565204, 180129.37438711102, 80682.04308496354], [-315246.41946041374, 180128.53121919194, 80681.78394966088], [-315247.00865253585, 180127.6880499292, 80681.52481374], [-315247.59784213436, 180126.844879145, 80681.26567714474], [-315248.2165739899, 180126.01854069624, 80681.01408476655], [-315248.8057584159, 180125.1753670608, 80680.75494688368], [-315249.3949403155, 180124.33219190832, 80680.49580832767], [-315249.9841195776, 180123.48901540507, 80680.23666916115], [-315250.5732963138, 180122.64583738797, 80679.97752931285], [-315251.1919930275, 180121.8195259452, 80679.72594429403], [-315251.78116465034, 180120.97634498638, 80679.46680312931], [-315252.37033368816, 180120.13316260037, 80679.20766132016], [-315252.9595226275, 180119.28994422793, 80678.948508155], [-315253.54868650157, 180118.44675897743, 80678.68936505343], [-315254.1673706147, 180117.6204398994, 80678.43777665666], [-315254.7565293775, 180116.77725170393, 80678.17863223841], [-315255.345685496, 180115.93406216847, 80677.91948721226], [-315255.93483909103, 180115.09087111527, 80677.66034150317], [-315256.55351313483, 180114.26454591224, 80677.40875039907], [-315257.14268409775, 180113.42131736487, 80677.14959266434], [-315257.73182999605, 180112.57812194005, 80676.89044499343], [-315258.3209733094, 180111.73492508798, 80676.63129667802], [-315258.91011404194, 180110.8917268022, 80676.37214771585], [-315259.52877548535, 180110.0653939637, 80676.12055323372], [-315260.1179110455, 180109.22219282683, 80675.86140298398], [-315260.70704408165, 180108.37899016918, 80675.60225206008], [-315261.2961744756, 180107.5357861681, 80675.34310052788], [-315261.88532488525, 180106.69254600594, 80675.08393757466], [-315262.5039736717, 180105.86620561907, 80674.83233974212], [-315263.0930964261, 180105.0229971625, 80674.57318621188], [-315263.6822165997, 180104.17978727247, 80674.31403203495], [-315264.2713341881, 180103.33657595539, 80674.05487721352], [-315264.8604491957, 180102.49336320464, 80673.79572174556], [-315265.4790854405, 180101.6670150922, 80673.54412050731], [-315266.0682178125, 180100.8237648497, 80673.28495301378], [-315266.65732512344, 180099.98054772723, 80673.025795584], [-315267.2464298511, 180099.13732917485, 80672.76663750927], [-315267.8355319392, 180098.2941092752, 80672.50747882461], [-315268.45415558136, 180097.46775353124, 80672.25587420914], [-315269.04325261276, 180096.62453060696, 80671.99671417203], [-315269.6323470589, 180095.78130625587, 80671.7375534905], [-315270.2214614035, 180094.9380459171, 80671.47838145241], [-315270.81055068586, 180094.09481870173, 80671.2192194787], [-315271.4291617271, 180093.26845532312, 80670.96761148545], [-315272.0182458956, 180092.42522516716, 80670.70844819563], [-315272.60732742207, 180091.58199366764, 80670.44928429763], [-315273.19640642655, 180090.73876064792, 80670.19011971625], [-315273.7854827853, 180089.89552629448, 80669.93095451882], [-315274.40408122574, 180089.06915528138, 80669.67934314799], [-315274.9931750711, 180088.22588324896, 80669.42016585755], [-315275.5822437915, 180087.3826444343, 80669.16099867062], [-315276.1713098699, 180086.53940427623, 80668.90183087475], [-315276.7898982427, 180085.71302713567, 80668.65021679568], [-315277.37895926635, 180084.8697839499, 80668.39104764718], [-315277.96801771113, 180084.0265393275, 80668.13187785164], [-315278.5570735116, 180083.18329336503, 80667.87270744826], [-315279.146149321, 180082.34001124994, 80667.61352561587], [-315279.76472503744, 180081.5136265559, 80667.36190819531], [-315280.35377319786, 180080.67037613917, 80667.1027357942], [-315280.94281877775, 180079.82712428825, 80666.84356274635], [-315281.53186177206, 180078.98387101095, 80666.58438905426], [-315282.12090218574, 180078.1406163, 80666.32521471543], [-315282.73946535605, 180077.31422389188, 80666.07359388156], [-315283.32852313103, 180076.47093169132, 80665.81440750866], [-315283.91755584755, 180075.62767260952, 80665.55523120845], [-315284.50658597867, 180074.7844121011, 80665.29605426372], [-315285.0956134722, 180073.94115024243, 80665.0368767086], [-315285.7141640432, 180073.11475019754, 80664.78525249693], [-315286.30318647734, 180072.27148531846, 80664.52607359087], [-315286.8922063308, 180071.42821900567, 80664.26689403808], [-315287.48122354, 180070.5849513531, 80664.00771387761], [-315288.07026076206, 180069.7416475378, 80663.74852228664], [-315288.6887987296, 180068.91523986243, 80663.49689469812], [-315289.2778083006, 180068.0719677523, 80663.23771253951], [-315289.8668152294, 180067.22869429924, 80662.97852977226], [-315290.4558196382, 180066.38541932259, 80662.7193463213], [-315291.0448214028, 180065.54214300594, 80662.46016226249], [-315291.663346769, 180064.71572769742, 80662.20853129672], [-315292.252365952, 180063.87241380438, 80661.94933516636], [-315292.8413600788, 180063.02913302998, 80661.6901491089], [-315293.4303516221, 180062.18585082615, 80661.43096240592], [-315294.0488669152, 180061.35942939835, 80661.17932873449], [-315294.63785334467, 180060.51614425395, 80660.92014071575], [-315295.2268371885, 180059.67285768336, 80660.66095205264], [-315295.81581839453, 180058.82956976278, 80660.40176277923], [-315296.40479707404, 180057.98628032903, 80660.14257282484], [-315297.0233222404, 180057.15981671138, 80659.89092506452], [-315297.6122958063, 180056.3165243366, 80659.6317337935], [-315298.2012667884, 180055.47323053263, 80659.37254187779], [-315298.7902351876, 180054.62993529838, 80659.11334931588], [-315299.3792010015, 180053.7866386377, 80658.85415610972], [-315299.9976910937, 180052.96020194053, 80658.60251568303], [-315300.58665179356, 180052.11690233948, 80658.34332116095], [-315301.17563238594, 180051.27356674836, 80658.08411528119], [-315301.7645879216, 180050.43026428408, 80657.82491946718], [-315302.3535408146, 180049.58696047703, 80657.56572304515], [-315302.9720183048, 180048.76051614754, 80657.31407924145], [-315303.56096608395, 180047.91720940394, 80657.05488149486], [-315304.14991133666, 180047.0739011433, 80656.79568307538], [-315304.73885400855, 180046.23059144933, 80656.53648400921], [-315305.3278166265, 180045.38724568154, 80656.277273559], [-315305.94628145575, 180044.56079380997, 80656.02562640683], [-315306.53521643014, 180043.717479746, 80655.76642537962], [-315307.1241488188, 180042.87416425606, 80655.50722370815], [-315307.71307862655, 180042.03084733273, 80655.24802139006], [-315308.30200579163, 180041.18752906687, 80654.98881846399], [-315308.92045807774, 180040.3610694729, 80654.7371679065], [-315309.5093801877, 180039.51774817993, 80654.47796362803], [-315310.09829971474, 180038.67442545723, 80654.21875870343], [-315310.68721665855, 180037.83110130447, 80653.95955313352], [-315311.30565887137, 180037.00463559217, 80653.70789987061], [-315311.894570701, 180036.16130849946, 80653.44869298498], [-315312.4834798854, 180035.31798006824, 80653.18948549246], [-315313.0723864914, 180034.47465019987, 80652.93027735225], [-315313.661290571, 180033.63131881834, 80652.67106853049], [-315314.2797427122, 180032.80481082882, 80652.41940114174], [-315314.86864161806, 180031.9614765947, 80652.16019104159], [-315315.4575379976, 180031.11814084733, 80651.90098025989], [-315316.04643179633, 180030.27480366614, 80651.64176883163], [-315316.6353230116, 180029.43146505585, 80651.38255675802], [-315317.25374001986, 180028.60498407998, 80651.13089674176], [-315317.8426260638, 180027.7616426136, 80650.87168338876], [-315318.431509581, 180026.91829963413, 80650.61246935488], [-315319.0204130413, 180026.07492058908, 80650.35324391827], [-315319.6092913352, 180025.23157483342, 80650.09402862925], [-315320.22769574256, 180024.4050862235, 80649.84236523599], [-315320.8165689791, 180023.56173744466, 80649.58314859502], [-315321.40543963, 180022.71838724, 80649.3239313098], [-315321.9943076998, 180021.87503560202, 80649.06471337817], [-315322.583173184, 180021.03168253799, 80648.8054948023], [-315323.2015874591, 180020.2051517373, 80648.55381731964], [-315323.7904478309, 180019.36179573045, 80648.29459742701], [-315324.3793055604, 180018.51843838065, 80648.03537692649], [-315324.96816076554, 180017.67507951465, 80647.7761557432], [-315325.55701338523, 180016.83171922213, 80647.51693391571], [-315326.17539252836, 180016.00521543683, 80647.2652638061]];
// const jd = [2457987.2194444444, 2457987.2194560184, 2457987.2194675924, 2457987.2194791664, 2457987.219490741, 2457987.219502315, 2457987.219513889, 2457987.219525463, 2457987.219537037, 2457987.219548611, 2457987.219560185, 2457987.2195717595, 2457987.2195833335, 2457987.2195949075, 2457987.2196064815, 2457987.2196180555, 2457987.2196296295, 2457987.2196412035, 2457987.219652778, 2457987.219664352, 2457987.219675926, 2457987.2196875, 2457987.219699074, 2457987.219710648, 2457987.219722222, 2457987.219733796, 2457987.2197453706, 2457987.2197569446, 2457987.2197685186, 2457987.2197800926, 2457987.2197916666, 2457987.2198032406, 2457987.2198148146, 2457987.219826389, 2457987.219837963, 2457987.219849537, 2457987.219861111, 2457987.219872685, 2457987.219884259, 2457987.219895833, 2457987.219907407, 2457987.2199189817, 2457987.2199305557, 2457987.2199421297, 2457987.2199537037, 2457987.2199652777, 2457987.2199768517, 2457987.2199884257, 2457987.22, 2457987.220011574, 2457987.220023148, 2457987.2200347222, 2457987.2200462963, 2457987.2200578703, 2457987.2200694443, 2457987.2200810183, 2457987.2200925928, 2457987.220104167, 2457987.220115741, 2457987.220127315, 2457987.220138889, 2457987.220150463, 2457987.220162037, 2457987.2201736113, 2457987.2201851853, 2457987.2201967593, 2457987.2202083333, 2457987.2202199074, 2457987.2202314814, 2457987.2202430554, 2457987.22025463, 2457987.220266204, 2457987.220277778, 2457987.220289352, 2457987.220300926, 2457987.2203125, 2457987.220324074, 2457987.220335648, 2457987.2203472224, 2457987.2203587964, 2457987.2203703704, 2457987.2203819444, 2457987.2203935185, 2457987.2204050925, 2457987.2204166665, 2457987.220428241, 2457987.220439815, 2457987.220451389, 2457987.220462963, 2457987.220474537, 2457987.220486111, 2457987.220497685, 2457987.220509259, 2457987.2205208335, 2457987.2205324075, 2457987.2205439815, 2457987.2205555555, 2457987.2205671296, 2457987.2205787036, 2457987.2205902776, 2457987.220601852, 2457987.220613426, 2457987.220625, 2457987.220636574, 2457987.220648148, 2457987.220659722, 2457987.220671296, 2457987.2206828706, 2457987.2206944446, 2457987.2207060186, 2457987.2207175926, 2457987.2207291666, 2457987.2207407407, 2457987.2207523147, 2457987.2207638887, 2457987.220775463, 2457987.220787037, 2457987.220798611, 2457987.220810185, 2457987.220821759, 2457987.220833333, 2457987.220844907, 2457987.2208564817, 2457987.2208680557, 2457987.2208796297, 2457987.2208912037, 2457987.2209027777, 2457987.2209143518, 2457987.2209259258, 2457987.2209375, 2457987.2209490743, 2457987.2209606483, 2457987.2209722223, 2457987.2209837963, 2457987.2209953703, 2457987.2210069443, 2457987.2210185183, 2457987.221030093, 2457987.221041667, 2457987.221053241, 2457987.221064815, 2457987.221076389, 2457987.221087963, 2457987.221099537, 2457987.2211111113, 2457987.2211226854, 2457987.2211342594, 2457987.2211458334, 2457987.2211574074, 2457987.2211689814, 2457987.2211805554, 2457987.2211921294, 2457987.221203704, 2457987.221215278, 2457987.221226852, 2457987.221238426, 2457987.22125, 2457987.221261574, 2457987.221273148, 2457987.2212847224, 2457987.2212962965, 2457987.2213078705, 2457987.2213194445, 2457987.2213310185, 2457987.2213425925, 2457987.2213541665, 2457987.2213657405, 2457987.221377315, 2457987.221388889, 2457987.221400463, 2457987.221412037, 2457987.221423611, 2457987.221435185, 2457987.221446759, 2457987.2214583335, 2457987.2214699076, 2457987.2214814816, 2457987.2214930556, 2457987.2215046296, 2457987.2215162036, 2457987.2215277776, 2457987.2215393516, 2457987.221550926, 2457987.2215625, 2457987.221574074, 2457987.221585648, 2457987.221597222, 2457987.221608796, 2457987.22162037, 2457987.2216319446, 2457987.2216435187, 2457987.2216550927, 2457987.2216666667, 2457987.2216782407, 2457987.2216898147, 2457987.2217013887, 2457987.221712963, 2457987.221724537, 2457987.221736111, 2457987.221747685, 2457987.2217592592, 2457987.2217708332, 2457987.2217824073, 2457987.2217939813, 2457987.2218055557, 2457987.2218171298, 2457987.221828704, 2457987.221840278, 2457987.221851852, 2457987.221863426, 2457987.221875, 2457987.2218865743, 2457987.2218981483, 2457987.2219097223, 2457987.2219212963, 2457987.2219328703, 2457987.2219444443, 2457987.2219560184, 2457987.2219675924, 2457987.221979167, 2457987.221990741, 2457987.222002315, 2457987.222013889, 2457987.222025463, 2457987.222037037, 2457987.222048611, 2457987.2220601854, 2457987.2220717594, 2457987.2220833334, 2457987.2220949074, 2457987.2221064814, 2457987.2221180554, 2457987.2221296295, 2457987.2221412035, 2457987.222152778, 2457987.222164352, 2457987.222175926, 2457987.2221875, 2457987.222199074, 2457987.222210648, 2457987.222222222, 2457987.2222337965, 2457987.2222453705, 2457987.2222569445, 2457987.2222685185, 2457987.2222800925, 2457987.2222916665, 2457987.2223032406, 2457987.222314815, 2457987.222326389, 2457987.222337963, 2457987.222349537, 2457987.222361111, 2457987.222372685, 2457987.222384259, 2457987.222395833, 2457987.2224074076, 2457987.2224189816, 2457987.2224305556, 2457987.2224421296, 2457987.2224537036, 2457987.2224652776, 2457987.2224768517, 2457987.222488426, 2457987.2225, 2457987.222511574, 2457987.222523148, 2457987.222534722, 2457987.222546296, 2457987.22255787, 2457987.222569444, 2457987.2225810187, 2457987.2225925927, 2457987.2226041667, 2457987.2226157407, 2457987.2226273147, 2457987.2226388888, 2457987.2226504628, 2457987.2226620372, 2457987.2226736112, 2457987.2226851853, 2457987.2226967593, 2457987.2227083333, 2457987.2227199073, 2457987.2227314813, 2457987.222743056, 2457987.22275463, 2457987.222766204, 2457987.222777778, 2457987.222789352, 2457987.222800926, 2457987.2228125, 2457987.222824074, 2457987.2228356483, 2457987.2228472224, 2457987.2228587964, 2457987.2228703704, 2457987.2228819444, 2457987.2228935184, 2457987.2229050924, 2457987.222916667, 2457987.222928241, 2457987.222939815, 2457987.222951389, 2457987.222962963, 2457987.222974537, 2457987.222986111, 2457987.222997685, 2457987.2230092594, 2457987.2230208335, 2457987.2230324075, 2457987.2230439815, 2457987.2230555555, 2457987.2230671295, 2457987.2230787035, 2457987.223090278, 2457987.223101852, 2457987.223113426, 2457987.223125, 2457987.223136574, 2457987.223148148, 2457987.223159722, 2457987.2231712965, 2457987.2231828705, 2457987.2231944446, 2457987.2232060186, 2457987.2232175926, 2457987.2232291666, 2457987.2232407406, 2457987.2232523146, 2457987.223263889, 2457987.223275463, 2457987.223287037, 2457987.223298611, 2457987.223310185, 2457987.223321759, 2457987.223333333, 2457987.2233449076, 2457987.2233564816, 2457987.2233680557, 2457987.2233796297, 2457987.2233912037, 2457987.2234027777, 2457987.2234143517, 2457987.2234259257, 2457987.2234375, 2457987.223449074, 2457987.223460648, 2457987.223472222, 2457987.223483796, 2457987.2234953702, 2457987.2235069443, 2457987.2235185187, 2457987.2235300927, 2457987.2235416668, 2457987.2235532408, 2457987.223564815, 2457987.223576389, 2457987.223587963, 2457987.223599537, 2457987.2236111113];

const sunPosList = [[-129158117.81858245, 72345896.25027306, 31362866.9735885], [-129158132.86359043, 72345873.01352575, 31362856.90173484], [-129158147.90798815, 72345849.7777105, 31362846.830285188], [-129158162.9523809, 72345826.54189248, 31362836.758834325], [-129158177.99676865, 72345803.30607165, 31362826.68738226], [-129158193.04115145, 72345780.07024802, 31362816.615928978], [-129158208.08552922, 72345756.83442162, 31362806.54447449], [-129158223.12990205, 72345733.59859242, 31362796.473018788], [-129158238.17487521, 72345710.3618256, 31362786.401156675], [-129158253.21923804, 72345687.12599084, 31362776.329698563], [-129158268.26359594, 72345663.89015329, 31362766.25823924], [-129158283.30794887, 72345640.65431295, 31362756.1867787], [-129158298.35229681, 72345617.41846983, 31362746.115316957], [-129158313.39663976, 72345594.18262391, 31362736.043854013], [-129158328.44097781, 72345570.94677523, 31362725.97238985], [-129158343.4853108, 72345547.71092369, 31362715.900924478], [-129158358.53024413, 72345524.4741346, 31362705.829052698], [-129158373.57456718, 72345501.23827751, 31362695.75758492], [-129158388.61888528, 72345478.00241767, 31362685.686115917], [-129158403.66319838, 72345454.76655501, 31362675.614645712], [-129158418.70750684, 72345431.53068992, 31362665.54317447], [-129158433.75180998, 72345408.29482172, 31362655.47170185], [-129158448.79610814, 72345385.05895074, 31362645.40022802], [-129158463.84100665, 72345361.82214206, 31362635.328347765], [-129158478.88529487, 72345338.58626546, 31362625.25687152], [-129158493.92957811, 72345315.35038611, 31362615.185394067], [-129158508.9738564, 72345292.11450395, 31362605.11391539], [-129158524.01812968, 72345268.878619, 31362595.04243552], [-129158539.062398, 72345245.64273126, 31362584.970954433], [-129158554.10666135, 72345222.40684074, 31362574.899472136], [-129158569.151525, 72345199.17001261, 31362564.82758344], [-129158584.1957784, 72345175.93411647, 31362554.75609873], [-129158599.2400268, 72345152.6982176, 31362544.68461281], [-129158614.28427023, 72345129.4623159, 31362534.613125686], [-129158629.32850868, 72345106.22641145, 31362524.541637346], [-129158644.37274218, 72345082.99050419, 31362514.4701478], [-129158659.41697069, 72345059.75459416, 31362504.39865704], [-129158674.4611942, 72345036.51868133, 31362494.327165086], [-129158689.50601803, 72345013.28183088, 31362484.255266707], [-129158704.55023159, 72344990.0459125, 31362474.18377232], [-129158719.59444022, 72344966.80999129, 31362464.112276737], [-129158734.63864382, 72344943.57406731, 31362454.040779933], [-129158749.6828425, 72344920.33814055, 31362443.969281934], [-129158764.72703616, 72344897.102211, 31362433.89778272], [-129158779.77122484, 72344873.86627866, 31362423.82628229], [-129158794.81601384, 72344850.62940867, 31362413.754375443], [-129158809.86019257, 72344827.39347073, 31362403.682872605], [-129158824.90436636, 72344804.15753004, 31362393.611368556], [-129158839.94853511, 72344780.92158651, 31362383.539863296], [-129158854.99269897, 72344757.68564025, 31362373.46835683], [-129158870.03685777, 72344734.44969119, 31362363.39684915], [-129158885.08101164, 72344711.21373935, 31362353.325340267], [-129158900.12516052, 72344687.97778471, 31362343.253830172], [-129158915.16990972, 72344664.74089241, 31362333.181913655], [-129158930.21404897, 72344641.50493255, 31362323.11040131], [-129158945.25818293, 72344618.26896955, 31362313.03888759], [-129158960.30231191, 72344595.03300373, 31362302.967372663], [-129158975.34643587, 72344571.79703519, 31362292.895856526], [-129158990.39055489, 72344548.5610638, 31362282.824339174], [-129159005.43466897, 72344525.32508963, 31362272.752820615], [-129159020.4793833, 72344502.08817784, 31362262.68089564], [-129159035.52348739, 72344478.85219811, 31362252.609374665], [-129159050.56758651, 72344455.61621554, 31362242.53785248], [-129159065.61168064, 72344432.38023026, 31362232.466329087], [-129159080.65576982, 72344409.14424217, 31362222.39480449], [-129159095.69985399, 72344385.90825129, 31362212.323278684], [-129159110.7439332, 72344362.67225762, 31362202.25175166], [-129159125.78861271, 72344339.43532628, 31362192.179818224], [-129159140.83268198, 72344316.19932704, 31362182.10828879], [-129159155.87674625, 72344292.96332501, 31362172.036758143], [-129159170.92080554, 72344269.72732021, 31362161.965226296], [-129159185.96485987, 72344246.49131258, 31362151.89369323], [-129159201.00890923, 72344223.25530216, 31362141.822158962], [-129159216.05295359, 72344200.01928896, 31362131.750623487], [-129159231.096993, 72344176.78327303, 31362121.67908679], [-129159246.14163269, 72344153.54631938, 31362111.60714369], [-129159261.18566214, 72344130.31029783, 31362101.53560458], [-129159276.22968662, 72344107.0742735, 31362091.464064274], [-129159291.27370608, 72344083.83824639, 31362081.392522745], [-129159306.3177206, 72344060.60221645, 31362071.320980005], [-129159321.36173014, 72344037.36618376, 31362061.24943606], [-129159336.40573469, 72344014.13014826, 31362051.17789091], [-129159351.45033956, 72343990.89317514, 31362041.10593934], [-129159366.49433416, 72343967.65713406, 31362031.034391776], [-129159381.5383238, 72343944.4210902, 31362020.96284301], [-129159396.58230847, 72343921.18504354, 31362010.891293023], [-129159411.62628813, 72343897.94899416, 31362000.819741823], [-129159426.67026284, 72343874.71294191, 31361990.74818942], [-129159441.71423292, 72343851.4768873, 31361980.67663598], [-129159456.75819764, 72343828.24082948, 31361970.605081145], [-129159471.8027627, 72343805.00383407, 31361960.533119906], [-129159486.8467175, 72343781.76777066, 31361950.461562667], [-129159501.89066729, 72343758.53170453, 31361940.390004225], [-129159516.93461213, 72343735.2956356, 31361930.31844457], [-129159531.978552, 72343712.05956383, 31361920.246883705], [-129159547.0224869, 72343688.82348932, 31361910.175321635], [-129159562.06641679, 72343665.58741203, 31361900.10375835], [-129159577.11094701, 72343642.35039707, 31361890.031788647], [-129159592.15486695, 72343619.11431417, 31361879.96022295], [-129159607.19878195, 72343595.8782285, 31361869.88865604], [-129159622.24269196, 72343572.64214005, 31361859.817087922], [-129159637.286597, 72343549.4060488, 31361849.745518595], [-129159652.33049704, 72343526.16995475, 31361839.67394806], [-129159667.37439209, 72343502.93385796, 31361829.60237632], [-129159682.41828221, 72343479.69775835, 31361819.530803367], [-129159697.46277258, 72343456.46072106, 31361809.458823986], [-129159712.50665276, 72343433.2246159, 31361799.38724862], [-129159727.5505279, 72343409.98850791, 31361789.315672047], [-129159742.5943981, 72343386.75239715, 31361779.244094256], [-129159757.63826333, 72343363.5162836, 31361769.172515262], [-129159772.68212356, 72343340.28016724, 31361759.10093506], [-129159787.72597885, 72343317.04404816, 31361749.029353645], [-129159802.7704344, 72343293.80699135, 31361738.957365803], [-129159817.8142797, 72343270.57086666, 31361728.885781966], [-129159832.85812005, 72343247.33473921, 31361718.814196937], [-129159847.9019554, 72343224.0986089, 31361708.74261069], [-129159862.94578576, 72343200.86247586, 31361698.67102323], [-129159877.98961115, 72343177.62634, 31361688.59943456], [-129159893.03343157, 72343154.39020136, 31361678.527844682], [-129159908.07785231, 72343131.15312505, 31361668.455848385], [-129159923.12166278, 72343107.91698085, 31361658.3842561], [-129159938.16546826, 72343084.68083385, 31361648.312662594], [-129159953.20926912, 72343061.44468443, 31361638.241068047], [-129159968.25306468, 72343038.20853183, 31361628.169472124], [-129159983.29685524, 72343014.97237648, 31361618.097874995], [-129159998.34064083, 72342991.73621832, 31361608.02627667], [-129160013.38442145, 72342968.50005737, 31361597.95467712], [-129160028.42880234, 72342945.26295878, 31361587.88267115], [-129160043.472573, 72342922.02679227, 31361577.81106919], [-129160058.51633866, 72342898.79062295, 31361567.73946601], [-129160073.56009938, 72342875.55445087, 31361557.667861637], [-129160088.6038551, 72342852.31827602, 31361547.596256047], [-129160103.64760588, 72342829.08209835, 31361537.52464925], [-129160118.69135165, 72342805.84591788, 31361527.453041237], [-129160133.73569769, 72342782.60879977, 31361517.381026812], [-129160148.77943352, 72342759.37261374, 31361507.309416384], [-129160163.82316437, 72342736.13642491, 31361497.237804756], [-129160178.8668903, 72342712.90023333, 31361487.166191902], [-129160193.91061118, 72342689.66403891, 31361477.094577856], [-129160208.95432709, 72342666.42784172, 31361467.022962596], [-129160223.99803802, 72342643.19164175, 31361456.951346133], [-129160239.04174401, 72342619.95543902, 31361446.879728455], [-129160254.08605021, 72342596.71829858, 31361436.80770436], [-129160269.12974626, 72342573.48209025, 31361426.736084253], [-129160284.17343728, 72342550.24587917, 31361416.66446295], [-129160299.21712334, 72342527.00966525, 31361406.592840433], [-129160314.26080441, 72342503.77344854, 31361396.52121672], [-129160329.30448051, 72342480.53722906, 31361386.449591786], [-129160344.34815165, 72342457.30100678, 31361376.37796565], [-129160359.39242308, 72342434.06384686, 31361366.305933084], [-129160374.43608424, 72342410.827619, 31361356.23430453], [-129160389.47974044, 72342387.59138836, 31361346.16267477], [-129160404.52339165, 72342364.35515496, 31361336.091043793], [-129160419.56703788, 72342341.11891873, 31361326.019411616], [-129160434.61067916, 72342317.88267976, 31361315.94777822], [-129160449.65431544, 72342294.64643797, 31361305.87614362], [-129160464.6979471, 72342271.41019376, 31361295.804507975], [-129160479.74217871, 72342248.17301151, 31361285.73246574], [-129160494.78580005, 72342224.93676136, 31361275.660827514], [-129160509.82941645, 72342201.70050845, 31361265.58918808], [-129160524.87302783, 72342178.46425271, 31361255.517547444], [-129160539.9166343, 72342155.22799419, 31361245.445905585], [-129160554.96023573, 72342131.99173288, 31361235.374262523], [-129160570.00383224, 72342108.75546882, 31361225.302618247], [-129160585.04802899, 72342085.51826705, 31361215.230567563], [-129160600.09161551, 72342062.28199738, 31361205.15892087], [-129160615.13519707, 72342039.04572494, 31361195.087272972], [-129160630.17877366, 72342015.80944972, 31361185.015623868], [-129160645.22234528, 72341992.57317166, 31361174.943973552], [-129160660.26591188, 72341969.33689086, 31361164.872322038], [-129160675.30947351, 72341946.10060729, 31361154.800669305], [-129160690.35363543, 72341922.863386, 31361144.72861015], [-129160705.3971871, 72341899.62709685, 31361134.656955], [-129160720.44073382, 72341876.39080487, 31361124.585298635], [-129160735.48427558, 72341853.15451011, 31361114.513641078], [-129160750.52781232, 72341829.9182126, 31361104.44198229], [-129160765.5713441, 72341806.68191221, 31361094.370322317], [-129160780.61487094, 72341783.44560911, 31361084.29866112], [-129160795.65839274, 72341760.20930319, 31361074.226998717], [-129160810.70251484, 72341736.97205965, 31361064.154929888], [-129160825.74602672, 72341713.73574814, 31361054.083265077], [-129160840.78953364, 72341690.4994339, 31361044.01159905], [-129160855.83303553, 72341667.26311684, 31361033.93993181], [-129160870.87653251, 72341644.026797, 31361023.86826336], [-129160885.92002445, 72341620.7904744, 31361013.79659371], [-129160900.96351144, 72341597.55414897, 31361003.72492285], [-129160916.00759871, 72341574.31688589, 31360993.652845558], [-129160931.05107577, 72341551.0805549, 31360983.58117228], [-129160946.09454781, 72341527.84422112, 31360973.509497788], [-129160961.13801488, 72341504.60788454, 31360963.437822092], [-129160976.18147734, 72341481.37154555, 31360953.36614535], [-129160991.22493449, 72341458.13520339, 31360943.29446724], [-129161006.26838666, 72341434.89885846, 31360933.22278791], [-129161021.3118338, 72341411.66251075, 31360923.151107375], [-129161036.35588127, 72341388.42522538, 31360913.079020415], [-129161051.39931847, 72341365.18887205, 31360903.007337466], [-129161066.44275075, 72341341.95251599, 31360892.935653307], [-129161081.48617804, 72341318.71615711, 31360882.86396794], [-129161096.52960034, 72341295.47979547, 31360872.792281367], [-129161111.57301767, 72341272.24343105, 31360862.720593583], [-129161126.61643001, 72341249.00706378, 31360852.64890458], [-129161141.6604426, 72341225.7697589, 31360842.57680916], [-129161156.70384502, 72341202.53338611, 31360832.505117748], [-129161171.74724242, 72341179.2970105, 31360822.43342513], [-129161186.79063486, 72341156.06063211, 31360812.3617313], [-129161201.8340223, 72341132.82425094, 31360802.29003626], [-129161216.87740481, 72341109.58786695, 31360792.218340013], [-129161231.9207823, 72341086.35148023, 31360782.146642562], [-129161246.96476008, 72341063.1141558, 31360772.074538678], [-129161262.00812763, 72341039.87776348, 31360762.00283881], [-129161277.0514902, 72341016.64136839, 31360751.931137722], [-129161292.09484778, 72340993.40497048, 31360741.859435428], [-129161307.13820045, 72340970.16856982, 31360731.787731934], [-129161322.18154809, 72340946.93216632, 31360721.716027226], [-129161337.22489074, 72340923.69576007, 31360711.644321304], [-129161352.26822841, 72340900.45935102, 31360701.572614186], [-129161367.31216638, 72340877.22200431, 31360691.500500627], [-129161382.35549413, 72340853.98558968, 31360681.42879109], [-129161397.39881691, 72340830.7491723, 31360671.35708033], [-129161412.4421347, 72340807.51275206, 31360661.28536837], [-129161427.48544751, 72340784.27632907, 31360651.213655207], [-129161442.52875534, 72340761.03990328, 31360641.141940825], [-129161457.57205819, 72340737.80347475, 31360631.07022524], [-129161472.61596166, 72340714.56610888, 31360620.998103388], [-129161487.65925455, 72340691.32967472, 31360610.926385388], [-129161502.70254247, 72340668.09323782, 31360600.85466617], [-129161517.74582544, 72340644.8567981, 31360590.782945752], [-129161532.78910342, 72340621.62035562, 31360580.71122412], [-129161547.8323764, 72340598.38391033, 31360570.63950128], [-129161562.87564443, 72340575.14746225, 31360560.567777235], [-129161577.91890746, 72340551.91101137, 31360550.496051982], [-129161592.96277077, 72340528.67362286, 31360540.423920296]];
const moonPosList = [[-315207.3732261617, 180181.12022791358, 80694.37253180768], [-315207.96876950125, 180180.28064063715, 80694.11500482846], [-315208.5642864164, 180179.44108579753, 80693.85748759857], [-315209.1598008734, 180178.60152950464, 80693.59996972507], [-315209.75531288894, 180177.76197181662, 80693.34245123705], [-315210.3508224464, 180176.92241270858, 80693.0849321096], [-315210.946329579, 180176.0828522303, 80692.82741237179], [-315211.5418342535, 180175.24329035688, 80692.56989198623], [-315212.1373604695, 180174.40369332285, 80692.31236062647], [-315212.7328602112, 180173.56412863426, 80692.05483899526], [-315213.32835754467, 180172.72456255884, 80691.79731673707], [-315213.92385242006, 180171.88499507168, 80691.53979385605], [-315214.51934485394, 180171.04542620602, 80691.28227033975], [-315215.11483482976, 180170.205855912, 80691.02474620893], [-315215.7103224139, 180169.36628425607, 80690.76722143868], [-315216.30580749013, 180168.52671113855, 80690.5096960456], [-315216.9013140912, 180167.68710292687, 80690.25215966586], [-315217.49679428455, 180166.8475270191, 80689.99463302297], [-315218.09227203636, 180166.00794976603, 80689.73710574897], [-315218.68774734664, 180165.16837106802, 80689.47957784796], [-315219.2832201823, 180164.32879098316, 80689.22204931584], [-315219.87869062624, 180163.4892095364, 80688.96452016504], [-315220.4741585457, 180162.6496266862, 80688.70699037895], [-315221.06964805647, 180161.81000860065, 80688.44944960621], [-315221.66511110956, 180160.97042293526, 80688.19191857448], [-315222.2605717046, 180160.13083584156, 80687.93438691576], [-315222.85602990794, 180159.2912473859, 80687.67685460931], [-315223.4514856034, 180158.45165750192, 80687.41932169249], [-315224.0469389072, 180157.61206624773, 80687.16178814869], [-315224.64238971967, 180156.77247357348, 80686.90425397376], [-315225.23786207364, 180155.932845722, 80686.64670882463], [-315225.83330800314, 180155.09325019937, 80686.38917339158], [-315226.42875150783, 180154.25365335634, 80686.13163733573], [-315227.0241925212, 180153.41405506837, 80685.87410066118], [-315227.6196311263, 180152.57445538524, 80685.61656335136], [-315228.2150672567, 180151.7348543319, 80685.35902542701], [-315228.81050099543, 180150.89525187513, 80685.10148685907], [-315229.4059322263, 180150.05564800662, 80684.84394766417], [-315230.00138494873, 180149.2160089775, 80684.5863974909], [-315230.59681131324, 180148.37640231874, 80684.32885704619], [-315231.19223523623, 180147.53679423992, 80684.07131597034], [-315231.78765666793, 180146.6971847826, 80683.81377427581], [-315232.38307567476, 180145.8575739135, 80683.55623195432], [-315232.9784922733, 180145.017961641, 80683.29868901], [-315233.573906364, 180144.17834798995, 80683.04114542209], [-315234.1693420293, 180143.3386991534, 80682.78359085167], [-315234.7647512204, 180142.49908267058, 80682.52604603056], [-315235.3601580032, 180141.65946480923, 80682.26850056586], [-315235.95556229475, 180140.81984550293, 80682.01095447833], [-315236.5509642279, 180139.98022488455, 80681.75340776799], [-315237.1463636364, 180139.1406028378, 80681.4958604182], [-315237.7417605869, 180138.30097937936, 80681.2383124539], [-315238.3371551291, 180137.46135452576, 80680.98076386262], [-315238.9325711796, 180136.62169450324, 80680.72320426807], [-315239.52796083887, 180135.78206681783, 80680.46565443114], [-315240.1233480234, 180134.94243776225, 80680.20810395892], [-315240.7187327831, 180134.1028072617, 80679.95055285141], [-315241.3141150515, 180133.26317545734, 80679.69300112524], [-315241.90949489496, 180132.42354218313, 80679.43544876378], [-315242.50487231364, 180131.5839075221, 80679.17789577534], [-315243.1002712239, 180130.74423770042, 80678.9203318044], [-315243.6956436932, 180129.90460024914, 80678.66277756616], [-315244.291013804, 180129.06496133626, 80678.40522269679], [-315244.8863814069, 180128.2253210947, 80678.14766720874], [-315245.48174656834, 180127.3856794912, 80677.89011108542], [-315246.07710927166, 180126.54603643448, 80677.63255435172], [-315246.6724695335, 180125.70639199924, 80677.37499697028], [-315247.26785133686, 180124.86671234522, 80677.1174286105], [-315247.86320671573, 180124.0270651031, 80676.85986998756], [-315248.4585596532, 180123.1874164575, 80676.60231073349], [-315249.0539100993, 180122.34776643344, 80676.34475085659], [-315249.64925813716, 180121.5081149561, 80676.08719034026], [-315250.24460373353, 180120.66846212512, 80675.82962920525], [-315250.83994683856, 180119.8288078492, 80675.57206744743], [-315251.4352875686, 180118.9891522446, 80675.314505046], [-315252.0306497405, 180118.14946139633, 80675.0569316787], [-315252.6259855543, 180117.30980296823, 80674.79936803578], [-315253.2213188769, 180116.47014312012, 80674.54180376588], [-315253.8166497579, 180115.63048191008, 80674.28423886486], [-315254.4119782141, 180114.79081926338, 80674.02667333685], [-315255.00730422884, 180113.95115522985, 80673.76910718187], [-315255.60262775223, 180113.11148977626, 80673.51154039991], [-315256.19797285035, 180112.27178918698, 80673.25396263959], [-315256.7932914742, 180111.43212093486, 80672.99639460782], [-315257.388607723, 180110.5924512876, 80672.73882595323], [-315257.9839214971, 180109.7527802369, 80672.48125666751], [-315258.5792327799, 180108.91310781598, 80672.2236867548], [-315259.1745416545, 180108.0734339833, 80671.96611621097], [-315259.7698480709, 180107.23375877214, 80671.70854504431], [-315260.3651520459, 180106.394082116, 80671.45097324238], [-315260.96047752915, 180105.55437032416, 80671.19339046208], [-315261.55577662116, 180104.71469087776, 80670.93581740618], [-315262.1510732052, 180103.87501007775, 80670.67824374407], [-315262.7463674143, 180103.0353278411, 80670.42066944251], [-315263.34165913204, 180102.1956442176, 80670.16309451398], [-315263.93694844155, 180101.35595920729, 80669.90551896262], [-315264.5322352597, 180100.51627276864, 80669.64794277599], [-315265.12754361937, 180099.67655116104, 80669.39035560269], [-315265.722825538, 180098.83686194042, 80669.1327781621], [-315266.318105065, 180097.99717128315, 80668.87520010698], [-315266.9133821172, 180097.15747926396, 80668.61762141243], [-315267.50865671143, 180096.31778586627, 80668.3600420992], [-315268.1039288641, 180095.4780910236, 80668.1024621507], [-315268.6991985255, 180094.63839486885, 80667.84488158351], [-315269.2944658285, 180093.798697211, 80667.5873003935], [-315269.88975454005, 180092.95896440087, 80667.32970819193], [-315270.4850169435, 180092.1192640192, 80667.07212574381], [-315271.08027680573, 180091.27956220918, 80666.81454266871], [-315271.67553429294, 180090.43985896252, 80666.55695896248], [-315272.2707893221, 180089.60015437054, 80666.29937462928], [-315272.86604189314, 180088.7604483336, 80666.04178967324], [-315273.46129202266, 180087.92074095138, 80665.78420408192], [-315274.0565636273, 180087.0809983504, 80665.5266074998], [-315274.65180885734, 180086.241288153, 80665.26902065454], [-315275.2470516624, 180085.40157656046, 80665.01143319889], [-315275.84229197627, 180084.56186352295, 80664.75384510797], [-315276.437529832, 180083.72214915676, 80664.49625638592], [-315277.03276527947, 180082.8824333373, 80664.23866702858], [-315277.6279982523, 180082.04271615596, 80663.98107705671], [-315278.22325276653, 180081.2029637226, 80663.72347608574], [-315278.8184808397, 180080.3632437427, 80663.46588485992], [-315279.4137064881, 180079.5235223676, 80663.20829300299], [-315280.00892969494, 180078.68379958914, 80662.95070051905], [-315280.6041504437, 180077.84407537399, 80662.6931074123], [-315281.1993687344, 180077.00434978862, 80662.43551368272], [-315281.7945846002, 180076.16462276658, 80662.17791932618], [-315282.3897979913, 180075.32489434944, 80661.92032433017], [-315282.98503289075, 180074.48513081318, 80661.66271835168], [-315283.58024141553, 180073.6453996141, 80661.40512210589], [-315284.175447449, 180072.80566699494, 80661.14752523726], [-315284.7706510742, 180071.96593300556, 80660.88992773752], [-315285.3658522413, 180071.12619767088, 80660.63232961079], [-315285.96105096693, 180070.28646088295, 80660.37473085707], [-315286.5562472345, 180069.44672269988, 80660.11713148054], [-315287.15146497707, 180068.60694931468, 80659.85952111319], [-315287.7466563617, 180067.76720836625, 80659.6019204744], [-315288.3418452882, 180066.92746595628, 80659.34431922938], [-315288.9370318397, 180066.087722201, 80659.08671733247], [-315289.5322158168, 180065.24797700904, 80658.8291148252], [-315290.1273973856, 180064.40823041368, 80658.57151168263], [-315290.722576513, 180063.5684824398, 80658.31390792556], [-315291.3177532155, 180062.72873308737, 80658.05630352904], [-315291.9129513598, 180061.8889484996, 80657.79868814588], [-315292.5081231794, 180061.0491963237, 80657.54108248709], [-315293.10329250764, 180060.2094427942, 80657.2834762221], [-315293.6984593944, 180059.36968779482, 80657.02586931767], [-315294.29362385627, 180058.52993145015, 80656.76826179872], [-315294.88878584345, 180057.6901736605, 80656.51065364033], [-315295.4839454224, 180056.85041451725, 80656.25304485497], [-315296.0791264598, 180056.01062015526, 80655.9954250871], [-315296.6742811059, 180055.17085821345, 80655.73781505194], [-315297.2694333106, 180054.3310948267, 80655.48020439809], [-315297.8645830572, 180053.4913300863, 80655.22259310065], [-315298.4597303789, 180052.65156390928, 80654.96498119285], [-315299.0554562149, 180051.81089493312, 80654.70697363676], [-315299.6505986204, 180050.97112597415, 80654.4493604667], [-315300.2457386011, 180050.13135560343, 80654.19174666966], [-315300.8409000734, 180049.29155007208, 80653.93412187765], [-315301.43603513786, 180048.4517769194, 80653.67650683496], [-315302.0311677609, 180047.61200237158, 80653.418891157], [-315302.6262979092, 180046.77222642032, 80653.1612748645], [-315303.2214256659, 180045.93244904903, 80652.90365793256], [-315303.81655093125, 180045.0926702992, 80652.6460403695], [-315304.4116737551, 180044.2528901875, 80652.3884221836], [-315305.00681808725, 180043.4130748487, 80652.13079301937], [-315305.60193602816, 180042.5732919052, 80651.87317357537], [-315306.19705151103, 180041.73350754994, 80651.6155535127], [-315306.7921645524, 180040.89372184937, 80651.3579328189], [-315307.38727516885, 180040.05393468725, 80651.10031151057], [-315307.98238327744, 180039.21414617152, 80650.84268957112], [-315308.57748899434, 180038.37435626064, 80650.58506699222], [-315309.1726161863, 180037.53453112274, 80650.32743343498], [-315309.76771693723, 180036.6947383967, 80650.06980961045], [-315310.3628153131, 180035.85494425893, 80649.81218514647], [-315310.9579112309, 180035.015148726, 80649.55456008042], [-315311.5530046574, 180034.17535180628, 80649.2969343708], [-315312.1480956922, 180033.33555341666, 80649.03930804665], [-315312.74318425235, 180032.4957537316, 80648.78168108306], [-315313.3382703378, 180031.65595261817, 80648.52405349664], [-315313.93337794807, 180030.8161163192, 80648.26641491942], [-315314.52845913393, 180029.9763123823, 80648.00878608736], [-315315.1235379614, 180029.13650709178, 80647.75115662416], [-315315.7186142311, 180028.2967003563, 80647.49352652983], [-315316.31368812575, 180027.4568922589, 80647.23589580438], [-315316.90875952906, 180026.6170827913, 80646.97826446024], [-315317.50382850756, 180025.7772718372, 80646.72063250159], [-315318.0989189943, 180024.93742574743, 80646.46298953552], [-315318.69398307323, 180024.0976120197, 80646.20535630631], [-315319.2890446774, 180023.25779690512, 80645.9477224501], [-315319.88410384016, 180022.4179803788, 80645.69008797938], [-315320.47916059464, 180021.5781625238, 80645.43245287339], [-315321.0742148744, 180020.73834319063, 80645.17481714455], [-315321.6692667293, 180019.89852247064, 80644.9171807846], [-315322.2643160929, 180019.05870041362, 80644.65954378936], [-315322.85938694817, 180018.2188431462, 80644.40189581577], [-315323.45443146204, 180017.3790182242, 80644.14425757487], [-315324.04947350116, 180016.53919194028, 80643.886618707], [-315324.6445131321, 180015.6993642363, 80643.62897922045], [-315325.23955025506, 180014.85953517043, 80643.37133909862], [-315325.8345849532, 180014.0197046762, 80643.11369835396], [-315326.4296172098, 180013.17987276195, 80642.85605697402], [-315327.0246709415, 180012.34000573689, 80642.59840461574], [-315327.6196983318, 180011.5001710656, 80642.340761986], [-315328.21472319757, 180010.66033495762, 80642.08311873343], [-315328.8097456883, 180009.82049745452, 80641.82547485387], [-315329.4047656711, 180008.9806585895, 80641.56783034735], [-315329.9997832789, 180008.14081830447, 80641.310185218], [-315330.5947983621, 180007.3009766575, 80641.05253945751], [-315331.1898349869, 180006.4610997752, 80640.79488270622], [-315331.78484520374, 180005.62125527984, 80640.53723568763], [-315332.379852946, 180004.78140945578, 80640.27958804206], [-315332.97485827986, 180003.94156216187, 80640.02193977781], [-315333.56986115576, 180003.10171353925, 80639.7642908866], [-315334.1648615901, 180002.26186343844, 80639.50664137254], [-315334.7598595664, 180001.42201198405, 80639.24899122736], [-315335.3548550514, 180000.5821591096, 80638.99134045935], [-315335.94987209444, 179999.74227107453, 80638.73367868809], [-315336.5448627297, 179998.9024153932, 80638.47602667028], [-315337.13985092344, 179998.06255838322, 80638.21837400473], [-315337.7348366757, 179997.22269987842, 80637.96072073295], [-315338.32981993665, 179996.38284003662, 80637.70306682591], [-315338.9248007894, 179995.5429787997, 80637.44541228772], [-315339.519779184, 179994.70311619254, 80637.18775712673], [-315340.11477905366, 179993.86321833346, 80636.9300909749], [-315340.70975256537, 179993.023352853, 80636.67243456825], [-315341.30472356913, 179992.18348602724, 80636.4147775263], [-315341.8996921978, 179991.34361781465, 80636.15711985738], [-315342.49465836847, 179990.50374817374, 80635.89946156564], [-315343.0896220478, 179989.66387711276, 80635.64180263861], [-315343.6845832856, 179988.82400468987, 80635.38414310121], [-315344.27954208193, 179987.98413085524, 80635.12648292852], [-315344.87452237, 179987.14422186, 80634.86881176088]];
const jd = [2457987.2209375, 2457987.2209490743, 2457987.2209606483, 2457987.2209722223, 2457987.2209837963, 2457987.2209953703, 2457987.2210069443, 2457987.2210185183, 2457987.221030093, 2457987.221041667, 2457987.221053241, 2457987.221064815, 2457987.221076389, 2457987.221087963, 2457987.221099537, 2457987.2211111113, 2457987.2211226854, 2457987.2211342594, 2457987.2211458334, 2457987.2211574074, 2457987.2211689814, 2457987.2211805554, 2457987.2211921294, 2457987.221203704, 2457987.221215278, 2457987.221226852, 2457987.221238426, 2457987.22125, 2457987.221261574, 2457987.221273148, 2457987.2212847224, 2457987.2212962965, 2457987.2213078705, 2457987.2213194445, 2457987.2213310185, 2457987.2213425925, 2457987.2213541665, 2457987.2213657405, 2457987.221377315, 2457987.221388889, 2457987.221400463, 2457987.221412037, 2457987.221423611, 2457987.221435185, 2457987.221446759, 2457987.2214583335, 2457987.2214699076, 2457987.2214814816, 2457987.2214930556, 2457987.2215046296, 2457987.2215162036, 2457987.2215277776, 2457987.2215393516, 2457987.221550926, 2457987.2215625, 2457987.221574074, 2457987.221585648, 2457987.221597222, 2457987.221608796, 2457987.22162037, 2457987.2216319446, 2457987.2216435187, 2457987.2216550927, 2457987.2216666667, 2457987.2216782407, 2457987.2216898147, 2457987.2217013887, 2457987.221712963, 2457987.221724537, 2457987.221736111, 2457987.221747685, 2457987.2217592592, 2457987.2217708332, 2457987.2217824073, 2457987.2217939813, 2457987.2218055557, 2457987.2218171298, 2457987.221828704, 2457987.221840278, 2457987.221851852, 2457987.221863426, 2457987.221875, 2457987.2218865743, 2457987.2218981483, 2457987.2219097223, 2457987.2219212963, 2457987.2219328703, 2457987.2219444443, 2457987.2219560184, 2457987.2219675924, 2457987.221979167, 2457987.221990741, 2457987.222002315, 2457987.222013889, 2457987.222025463, 2457987.222037037, 2457987.222048611, 2457987.2220601854, 2457987.2220717594, 2457987.2220833334, 2457987.2220949074, 2457987.2221064814, 2457987.2221180554, 2457987.2221296295, 2457987.2221412035, 2457987.222152778, 2457987.222164352, 2457987.222175926, 2457987.2221875, 2457987.222199074, 2457987.222210648, 2457987.222222222, 2457987.2222337965, 2457987.2222453705, 2457987.2222569445, 2457987.2222685185, 2457987.2222800925, 2457987.2222916665, 2457987.2223032406, 2457987.222314815, 2457987.222326389, 2457987.222337963, 2457987.222349537, 2457987.222361111, 2457987.222372685, 2457987.222384259, 2457987.222395833, 2457987.2224074076, 2457987.2224189816, 2457987.2224305556, 2457987.2224421296, 2457987.2224537036, 2457987.2224652776, 2457987.2224768517, 2457987.222488426, 2457987.2225, 2457987.222511574, 2457987.222523148, 2457987.222534722, 2457987.222546296, 2457987.22255787, 2457987.222569444, 2457987.2225810187, 2457987.2225925927, 2457987.2226041667, 2457987.2226157407, 2457987.2226273147, 2457987.2226388888, 2457987.2226504628, 2457987.2226620372, 2457987.2226736112, 2457987.2226851853, 2457987.2226967593, 2457987.2227083333, 2457987.2227199073, 2457987.2227314813, 2457987.222743056, 2457987.22275463, 2457987.222766204, 2457987.222777778, 2457987.222789352, 2457987.222800926, 2457987.2228125, 2457987.222824074, 2457987.2228356483, 2457987.2228472224, 2457987.2228587964, 2457987.2228703704, 2457987.2228819444, 2457987.2228935184, 2457987.2229050924, 2457987.222916667, 2457987.222928241, 2457987.222939815, 2457987.222951389, 2457987.222962963, 2457987.222974537, 2457987.222986111, 2457987.222997685, 2457987.2230092594, 2457987.2230208335, 2457987.2230324075, 2457987.2230439815, 2457987.2230555555, 2457987.2230671295, 2457987.2230787035, 2457987.223090278, 2457987.223101852, 2457987.223113426, 2457987.223125, 2457987.223136574, 2457987.223148148, 2457987.223159722, 2457987.2231712965, 2457987.2231828705, 2457987.2231944446, 2457987.2232060186, 2457987.2232175926, 2457987.2232291666, 2457987.2232407406, 2457987.2232523146, 2457987.223263889, 2457987.223275463, 2457987.223287037, 2457987.223298611, 2457987.223310185, 2457987.223321759, 2457987.223333333, 2457987.2233449076, 2457987.2233564816, 2457987.2233680557, 2457987.2233796297, 2457987.2233912037, 2457987.2234027777, 2457987.2234143517, 2457987.2234259257, 2457987.2234375, 2457987.223449074, 2457987.223460648, 2457987.223472222, 2457987.223483796, 2457987.2234953702, 2457987.2235069443, 2457987.2235185187, 2457987.2235300927, 2457987.2235416668, 2457987.2235532408, 2457987.223564815, 2457987.223576389, 2457987.223587963, 2457987.223599537, 2457987.2236111113];

class App extends React.Component<undefined, AppState> {
  private moon = new Moon();
  private sun = new Sun();
  private timerId = -1;

  constructor(props?: any, context?: any) {
    super(props, context);

    this.state = {
      now: 10   //Date.now()
    }
  }

  componentDidMount() {
    /* this.timerId = window.setInterval(
      () => {
        this.setState({
          now: this.state.now + 1000 * 60 // * 60 * 30
        });
      }, 100); */
    /*this.timerId = window.setInterval(
        () => {
          this.setState({
            now: this.state.now + 1 // 1000 * 60 // * 60 * 30
          });
        }, 100);*/
  }

  componentWillUnmount() {
    window.clearInterval(this.timerId);
  }

  len(v: number[] | mathjs.Matrix): number {
    return math.sqrt(math.dot(v, v));
  }

  normalize(v: number[] | mathjs.Matrix): number[] {
    return math.divide(v, this.len(v)) as number[];
  }

  raySphereIntersection(sphereRadius: number, rayStart: number[] | mathjs.Matrix, rayDirection: number[] | mathjs.Matrix): number[] {
    const a = math.dot(rayDirection, rayDirection); // Should be 1.
    const b = 2 * math.dot(rayStart, rayDirection);
    const c = math.dot(rayStart, rayStart) - sphereRadius * sphereRadius;

    const d = b * b - 4 * a * c;

    if (d < 0) {
      return null;
    } else if (d >= 0) {
      const t = (-b + math.sqrt(d)) / a / 2;
      const p = math.add(rayStart, math.multiply(rayDirection, t)) as number[];

      return p;
    }
  }

  rayEllipsoidIntersection1(eqR: number, polarR: number, rayStart: number[] | mathjs.Matrix, rayDirection: number[] | mathjs.Matrix): number[] {
    const polarScale = eqR / polarR;
    const scale = [1, 1, polarScale];
    const rayStartScaled = math.dotMultiply(rayStart, scale) as mathjs.Matrix;
    const rayDirectionScaled = math.dotMultiply(rayDirection, scale) as mathjs.Matrix;
    return this.raySphereIntersection(eqR, rayStartScaled, rayDirectionScaled);
  }

  rayEllipsoidIntersection(eqR: number, polarR: number, rayStart: number[] | mathjs.Matrix, rayDirection: number[] | mathjs.Matrix): number[] {
    const radius = [eqR, eqR, polarR];
    const at = math.dotDivide(rayDirection, radius) as mathjs.Matrix;
    const a = math.dot(at, at);
    const b = 2 * math.sum(math.dotDivide(math.dotMultiply(rayStart, rayDirection), math.dotPow(radius, 2)));
    const ct = math.dotDivide(rayStart, radius) as mathjs.Matrix;
    const c = math.dot(ct, ct) - 1;

    const d = b * b - 4 * a * c;

    if (d < 0) {
      return null;
    } else if (d >= 0) {
      const t = (-b + math.sqrt(d)) / a / 2;
      const p = math.add(rayStart, math.multiply(rayDirection, t)) as number[];

      //const p2 = this.rayEllipsoidIntersection1(eqR, polarR, rayStart, rayDirection);
      //console.log(this.len(math.subtract(p, p2) as number[]));

      return p;
    }
  }

  radec2xyz(lat: number, lon: number): number[] {
    var cosLat = Math.cos(lat);
    var sinLat = Math.sin(lat);
    var cosLon = Math.cos(lon);
    var sinLon = Math.sin(lon);
    var rad = 6378137.0;
    var f = 1.0 / 298.257224;
    var C = 1.0 / Math.sqrt(cosLat * cosLat + (1 - f) * (1 - f) * sinLat * sinLat);
    var S = (1.0 - f) * (1.0 - f) * C;
    var h = 0.0;
    const x = (rad * C + h) * cosLat * cosLon;
    const y = (rad * C + h) * cosLat * sinLon;
    const z = (rad * S + h) * sinLat;

    return [x, y, z];
  }

  xyzToSpherical(xyz: any): EquatorialCoordinate {
    const r = this.len(xyz);
    const dec = math.asin(xyz._data[2] / r);
    const ra = math.atan2(xyz._data[1], xyz._data[0]);
    return new EquatorialCoordinate(ra, dec, r);
  }

  sphericalToXyz(c: EquatorialCoordinate): number[] {
    const cosLat = Math.cos(c.dec);
    const sinLat = Math.sin(c.dec);
    const cosLon = Math.cos(c.ra);
    const sinLon = Math.sin(c.ra);

    const x = c.r * cosLat * cosLon;
    const y = c.r * cosLat * sinLon;
    const z = c.r * sinLat;

    return [x, y, z];
  }

  fixPrecession(c: EquatorialCoordinate, jde: number): EquatorialCoordinate {
    const t = j2000jd(jde) / 365.25;
    const dec = c.dec + degToRad(20.0431 / 3600) * math.cos(c.ra) * t;
    console.log(radToDeg(dec - c.dec));
    const ra = c.ra + (degToRad(3.07496 * 15 / 3600) + degToRad(1.33621 * 15 / 3600) * math.sin(c.ra) * math.tan(c.dec) * t);
    return new EquatorialCoordinate(ra, dec, c.r);
  }

  render(): any {
    // Radius.
    const sunR = 695700; // in km.
    const moonR = 1737; // in km.
    const earthR = 6371; // Mean
    const earthPolarR = 6356.752;
    const earthEqR = 6378.137;

    // const fixedJde = 2457987.267766; // 18:25:35.0
    // const fixedJde = 2457987.266667; // 18:24:00.0
    const fixedJde = 2457987.220833; // 17:18:00.0

    // From PyEphem. They are in Geocentic Equatorial space.
    // const sunGeocenticPos = [-129219042.12033698, 72251925.53185461, 31322144.954296015];
    // const moonGeocenticPos = [-317578.3699640539, 176801.90765448488, 79659.81420635643];
    // const sunGeocenticPos = [-129543897.83845954, 71761895.41801041, 31106238.079610456];
    // const moonGeocenticPos = [-318345.5914855474, 175643.69220487468, 79139.07074740899];
    const idx = math.ceil(this.state.now % sunPosList.length);
    var sunGeocenticPos = math.matrix(sunPosList[idx]);
    var moonGeocenticPos = math.matrix(moonPosList[idx]);

    // Fix precession.
    sunGeocenticPos = math.matrix(this.sphericalToXyz(this.fixPrecession(this.xyzToSpherical(sunGeocenticPos), jd[idx])));
    moonGeocenticPos = math.matrix(this.sphericalToXyz(this.fixPrecession(this.xyzToSpherical(moonGeocenticPos), jd[idx])));

    // Find the shadow cone length and angle.
    const moonFromSunPos = math.subtract(moonGeocenticPos, sunGeocenticPos) as number[];
    const moonDistFromSun = this.len(moonFromSunPos) as number;
    const coneLength = moonDistFromSun * sunR / (sunR - moonR);
    const coneAngle = math.asin((sunR - moonR) / moonDistFromSun);

    // Sun-Moon space: Sun is at [0, 0, 0]. Moon is at [moonDistFromSun, 0, 0].
    // Construct the cone (vertex and directions) in the Sun-Moon space to exploit symmetry.
    const coneVertexSunMoonPos = [coneLength, 0, 0];
    const rayX = -math.cos(coneAngle); // Pointing from the vertex back to the Sun.
    const rayY = (sunR - moonR) / moonDistFromSun;
    var coneSunMoonDirs: number[][] = [];
    const shadowBoundarySampleCount = 36;
    for (var i = 0; i < shadowBoundarySampleCount; ++i) {
      const angle = i / shadowBoundarySampleCount * 2 * math.pi;
      coneSunMoonDirs.push([rayX, math.cos(angle) * rayY, math.sin(angle) * rayY]);
    }

    // Calculate the basis of the Sun-Moon space to transform the cone.
    const xAxisSunMoon = this.normalize(moonFromSunPos);
    // This will work as Earth's ecliptic plane will never be parallel to the Sun-Moon plane.
    const zAxisSunMoon = this.normalize(math.cross(xAxisSunMoon, [0, 0, 1]));
    const yAxisSunMoon = this.normalize(math.cross(zAxisSunMoon, xAxisSunMoon));

    // Construct the rotation matrix from basis.
    const sunMoonBasis = math.matrix([xAxisSunMoon, yAxisSunMoon, zAxisSunMoon]);

    // Now, transform the cone into Geocentic Equatorial space.
    const coneVertexGeocenticPos = math.add(sunGeocenticPos, math.multiply(coneVertexSunMoonPos, sunMoonBasis)) as number[];
    const coneGeocenticDirs = coneSunMoonDirs.map(d => this.normalize(math.multiply(d, sunMoonBasis)));

    // const shadowXyzs = coneGeocenticDirs.map(d => this.raySphereIntersection(earthR, coneVertexGeocenticPos, d));
    const shadowXyzs = coneGeocenticDirs.map(d => this.rayEllipsoidIntersection(earthEqR, earthPolarR, coneVertexGeocenticPos, d));
    const shadowEquatorialCoordinates = shadowXyzs.map(c => this.xyzToSpherical(c)).map(c => c.eciToECEF(jd[idx]));
    // const shadowLatLon = shadowEquatorialCoordinates.map(c => c.toLatLng());
    const shadowLatLon = shadowEquatorialCoordinates
      .map(c => this.radec2xyz(c.dec, c.ra))
      .map(c => projector.unproject(c[0], c[1], c[2]))
      .map(c => {return {lat: c[0], lng: c[1]}});

    const nowJd = unixTimestampToJulianDate(this.state.now / 1000);
    const periodInJulianDay = 1.5;

    const sunTrack = calculateGroundTrack(this.sun, nowJd, periodInJulianDay, 64);
    const moonTrack = calculateGroundTrack(this.moon, nowJd, periodInJulianDay, 64);
    const nightOverlayCenter = {lat: -sunTrack.position.lat, lng: sunTrack.position.lng + 180};

    const shadowsMarkers = shadowLatLon.map(latLon => <MapMarker pos={latLon} />);

    return (
      <Map>
        <div className="info-box">{ new Date(this.state.now).toUTCString() }</div>
        { shadowsMarkers }
        <MapGroundTrack groundTrack={moonTrack} iconUrl="moon.png" iconSize={26} />
        <MapGroundTrack groundTrack={sunTrack} iconUrl="sun.png" iconSize={40} />
      </Map>
        // <MapCircle center={nightOverlayCenter} radius={6371e3 * Math.PI * 0.5}/>
    );
  }
}

ReactDOM.render(<App/>, document.getElementById("app"));
